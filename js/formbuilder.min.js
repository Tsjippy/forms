(()=>{var e,t,l,o,n;function i(){try{o.querySelectorAll("input:not([type=hidden]), select, textarea, [name=insertafter], [name=element-id]").forEach((function(e){if("checkbox"==e.type?e.checked=!1:e.value="","textarea"==e.type&&""!=e.id){let t=tinyMCE.get(e.id);null!=t&&t.setContent("")}"select-one"==e.type&&(FormFunctions.removeDefaultSelect(e),null!=e._niceSelect&&(e._niceSelect.clear(),e._niceSelect.update()))})),f(o.querySelector("form"))}catch(e){console.error(e)}}function a(e){e.querySelectorAll(".form-element-wrapper").forEach(((e,t)=>{e.dataset.priority=t+1}))}async function r(e,t=!1){let l,o=!0,n=!1,r=e.closest("form");""!=r.querySelector('[name="element-id"]').value&&(n=!0);let s,c=document.querySelector(".form-elements .clicked");if(null==c){if(!window.location.href.includes("formbuilder=true")){let e="&";return window.location.href.includes("?")||(e="?"),void(window.location.href=window.location.href+e+"formbuilder=true")}l=document.querySelector(".form-elements"),priority=1}else l=c.closest(".form-element-wrapper"),priority=parseInt(l.dataset.priority)+1;if(!n){let e=Main.showLoader(l,!1);e.dataset.priority=priority,e.classList.add("form-element-wrapper"),a(c.closest("form"));var d={};document.querySelectorAll(".form-element-wrapper").forEach((e=>{d[e.dataset.id]=e.dataset.priority})),d=JSON.stringify(d)}if(t){let e=new FormData;e.append("elid",l.dataset.id),e.append("formid",l.dataset.formid),e.append("order",d),s=await FormSubmit.fetchRestApi("forms/copy_form_element",e)}else s=n?await FormSubmit.submitForm(e,"forms/add_form_element"):await FormSubmit.submitForm(e,"forms/add_form_element",d);s&&(n?c.closest(".form-element-wrapper").outerHTML=s.html:(i(),document.querySelectorAll(".loader-wrapper").forEach((e=>e.outerHTML=s.html)),r.querySelectorAll(".resizer").forEach((e=>{u.observe(e)}))),Main.hideModals(),Main.displayMessage(s.message),null!=c&&c.classList.remove("clicked")),document.querySelectorAll(".loader-wrapper").forEach((e=>e.remove()))}async function s(e,t){if(t!=e.dataset.widthpercentage&&Math.abs(t-e.dataset.widthpercentage)>5){e.dataset.widthpercentage=t;let l=new FormData;l.append("formid",e.closest(".form-element-wrapper").dataset.formid),l.append("elementid",e.closest(".form-element-wrapper").dataset.id),l.append("new_width",t);let o=await FormSubmit.fetchRestApi("forms/edit_formfield_width",l);o&&(Main.hideModals(),Main.displayMessage(o))}}async function c(e){let t=e.parentNode,l=e.closest(".form-element-wrapper"),o=l.dataset.formid,n=l.dataset.id,i=e.closest("form");Main.showLoader(e);let r=t.querySelector(".loader-wrapper");r.style.paddingRight="10px",r.classList.remove("loader-wrapper");let s=new FormData;s.append("formid",o),s.append("elementindex",n);let c=await FormSubmit.fetchRestApi("forms/remove_element",s);c&&(l.remove(),a(i),Main.displayMessage(c))}async function d(t){if(e){let e={icon:"error",title:"ordering already in progress, please wait",confirmButtonColor:"#bd2919"};null!=document.fullscreenElement&&(e.target=document.fullscreenElement),Swal.fire(e)}else{e=!0,a(t.item.closest("form"));let l=new FormData;l.append("form_id",t.item.dataset.formid),l.append("el_id",t.item.dataset.id);let o={};document.querySelectorAll(".form-element-wrapper").forEach((e=>{o[e.dataset.id]=e.dataset.priority})),l.append("indexes",JSON.stringify(o));let n=await FormSubmit.fetchRestApi("forms/reorder-form-elements",l);n&&(e=!1,Main.displayMessage(n))}}console.log("Formbuilder.js loaded");const u=new ResizeObserver((function(e){let t=e[0].target;if(null!=t.parentNode){var l=e[0].contentRect.width,o=Math.round(l/t.parentNode.offsetWidth*100);let i=t.querySelector(".widthpercentage");o<99?i.textContent=o+"%":null!=i&&(i.textContent=""),clearTimeout(n),n=setTimeout(s,500,t,o)}}));function m(e,t){switch(f(t),t.querySelectorAll(`.element-option:not(.${e}, .reverse), .element-option.not${e}`).forEach((e=>e.classList.replace("shouldhide","hidden"))),t.querySelectorAll(`.element-option.${e}`).forEach((e=>e.classList.replace("hidden","shouldhide"))),null!=document.querySelector(".clicked")&&null!=document.querySelector(".clicked").closest(".form-element-wrapper.multi-answer-element")&&t.querySelectorAll(".element-option.multi-answer-element").forEach((e=>e.classList.replace("hidden","shouldhide"))),e){case"button":case"formstep":case"label":t.querySelector('[name="labeltext"] .elementtype').textContent=e;break;case"info":t.querySelector('[name="infotext"] .type').textContent="infobox";break;case"hcaptcha":case"recaptcha":case"turnstile":o.querySelectorAll(".shouldhide").forEach((e=>e.classList.replace("shouldhide","hidden"))),o.querySelectorAll('[name="elementname"]').forEach((e=>e.classList.replace("hidden","shouldhide")));break;case"radio":case"select":case"checkbox":case"datalist":case"php":default:break;case"p":t.querySelector('[name="infotext"] .type').textContent="Paragraph";break;case"file":case"image":t.querySelectorAll(".filetype").forEach((t=>{t.textContent=e}))}}function f(e){e.querySelectorAll(".element-option.reverse").forEach((e=>e.classList.replace("hidden","shouldhide")))}function h(e){let t=FormFunctions.cloneNode(e),l=parseInt(e.dataset.rule_index)+1;t.dataset.rule_index=l,e.parentNode.insertBefore(t,e.nextSibling),p(e.closest(".condition-row"))}function p(e){let t=e.querySelectorAll(".element-conditions-wrapper .rule-row"),l=0;t.forEach((e=>{e.dataset.rule_index=l,e.querySelectorAll(".element_condition").forEach((function(e){null!=e.id&&(e.id=e.id.replace(/([0-9]+\]\[rules\]\[)[0-9]+/g,"$1"+l)),null!=e.name&&(e.name=e.name.replace(/([0-9]+\]\[rules\]\[)[0-9]+/g,"$1"+l))})),l++}))}function y(){let e=o.querySelectorAll(".element-conditions-wrapper .condition-row");for(let t=0;t<e.length;t++)e[t].dataset.condition_index=t,e[t].querySelectorAll(".element_condition").forEach((function(e){null!=e.id&&(e.id=e.id.replace(/[0-9]+(\]\[rules\]\[[0-9]+)/g,t+"$1"),e.id.replace(/[0-9]+(\]\[action\])/g,t+"$1"),e.id=e.id.replace(/(element-conditions\[)[0-9]+\]\[+/g,"$1"+t+"][")),null!=e.name&&(e.name=e.name.replace(/[0-9]+(\]\[rules\]\[[0-9]+)/g,t+"$1"),e.name=e.name.replace(/[0-9]+(\]\[action\])/g,t+"$1"),e.name=e.name.replace(/(element-conditions\[)[0-9]+\]\[+/g,"$1"+t+"]["))}))}function w(e){var t=e.querySelectorAll(".warning_conditions"),l=0;t.forEach((e=>{e.dataset.index=l,e.querySelectorAll(".warning_condition").forEach((function(e){null!=e.name&&(e.name=e.name.replace(/([0-9])+/g,l)),null!=e.id&&(e.id=e.id.replace(/([0-9])+/g,l)),null!=e.list&&e.setAttribute("list",e.list.id.replace(/([0-9])+/g,l))})),l++}))}e=!1,document.addEventListener("DOMContentLoaded",(function(){let e={handle:".movecontrol",animation:150,onEnd:d};document.querySelectorAll(".form-elements").forEach((t=>{Sortable.create(t,e)})),document.querySelectorAll(".resizer").forEach((e=>{u.observe(e)}))})),window.addEventListener("click",(e=>{let n=e.target;if(t=n.closest(".sim-form-wrapper"),l=n.closest(".form-element-wrapper"),null!=t&&(o=t.querySelector(".add_form_element_modal")),"showid"==n.name)!function(e){const l=new URL(window.location);"show"==e.dataset.action?(l.searchParams.set("showid","true"),t.querySelectorAll(".elid.hidden").forEach((e=>e.classList.remove("hidden"))),e.textContent="Hide ids",e.dataset.action="hide"):(l.searchParams.delete("showid"),t.querySelectorAll(".elid:not(.hidden)").forEach((e=>e.classList.add("hidden"))),e.textContent="Show ids",e.dataset.action="show"),window.history.pushState({},"",l)}(n);else if("showname"==n.name)!function(e){const l=new URL(window.location);"show"==e.dataset.action?(l.searchParams.set("showname","true"),t.querySelectorAll(".elname.hidden").forEach((e=>e.classList.remove("hidden"))),e.textContent="Hide names",e.dataset.action="hide"):(l.searchParams.delete("showid"),t.querySelectorAll(".elname:not(.hidden)").forEach((e=>e.classList.add("hidden"))),e.textContent="Show names",e.dataset.action="show"),window.history.pushState({},"",l)}(n);else if("submit-form-element"==n.name)e.stopPropagation(),r(n);else if("submit-form-condition"==n.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_element-conditions");t&&(Main.hideModals(),Main.displayMessage(t))}(n);else if("submit-form-setting"==n.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_form_settings");t&&Main.displayMessage(t)}(n);else if("submit-form-emails"==n.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_form_emails");t&&(e.closest(".submit-wrapper").querySelector(".loader-wrapper").classList.add("hidden"),Main.displayMessage(t))}(n);else if("autoarchive"==n.name){let e=n.closest(".formsettings_wrapper").querySelector(".autoarchivelogic");"true"==n.value?e.classList.remove("hidden"):e.classList.add("hidden")}else"save-in-meta"==n.name?n.closest(".sim-form.builder").querySelector(".recurring-submissions").classList.toggle("hidden"):"formfield[mandatory]"==n.name&&n.checked&&(n.closest("div").querySelector('[name="formfield[recommended]"]').checked=!0);if(n.classList.contains("edit-form-element")&&async function(e){e.classList.add("clicked");let t=l.dataset.id,n=e.closest(".form-element-wrapper").dataset.formid;o.querySelector('[name="element-id"]').value=l.dataset.id,o.originalhtml=e.outerHTML;let i=e.outerHTML,a=Main.showLoader(e);a.querySelector(".loader").style.margin="5px 19px 0px 19px";let r=new FormData;r.append("elementid",t),r.append("formid",n);let s=await FormSubmit.fetchRestApi("forms/request_form_element",r);s&&(null!=o.querySelector('[name="add_form_element_form"]')&&(o.querySelector('[name="add_form_element_form"]').innerHTML=s.elementForm,o.querySelectorAll(".wp-editor-area").forEach((e=>{tinymce.execCommand("mceRemoveEditor",!1,e.id),tinymce.execCommand("mceAddEditor",!1,e.id)}))),m(o.querySelector('[name="formfield[type]"]').value,o.querySelector('[name="add_form_element_form"]')),o.querySelector(".element-conditions-wrapper").innerHTML=s.conditionsHtml,o.querySelectorAll("select").forEach((function(e){Main.attachNiceSelect(e)})),Main.showModal(o),a.outerHTML=i)}(n),n.classList.contains("copy-form-element")&&(n.classList.add("clicked"),r(n,!0)),n.classList.contains("remove-form-element")&&function(e){if("undefined"==typeof Swal)c(e);else{let t={title:"Are you sure?",text:"This will remove this element",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"};null!=document.fullscreenElement&&(t.target=document.fullscreenElement),Swal.fire(t).then((t=>{t.isConfirmed&&c(e)}))}}(n),n.classList.contains("add-form-element")||"createform"==n.name){if(!window.location.href.includes("&formbuilder=true"))return void(window.location.href=window.location.href+"&formbuilder=true");!async function(e){e.classList.add("clicked");let t=e.dataset.formid;null==t&&(t=null!=e.closest(".form-element-wrapper")?e.closest(".form-element-wrapper").dataset.formid:document.querySelector('input[type=hidden][name="formid"').value),i(),o.querySelectorAll(".shouldhide").forEach((e=>e.classList.replace("shouldhide","hidden"))),null!=l&&(o.querySelector('[name="insertafter"]').value=l.dataset.priority),o.querySelector('[name="submit-form-element"]').textContent=o.querySelector('[name="submit-form-element"]').textContent.replace("Change","Add"),o.querySelector(".element-conditions-wrapper").innerHTML=Main.showLoader(null,!1,50,"",!0),Main.showModal(o);var n=new FormData;n.append("elementid","-1"),n.append("formid",t);var a=await FormSubmit.fetchRestApi("forms/request_form_conditions_html",n);o.querySelector(".element-conditions-wrapper").innerHTML=a,o.querySelectorAll(".condition-select").forEach((function(e){Main.attachNiceSelect(e)}))}(n)}if(null!=n.closest(".elementtype")&&(m(n.dataset.value,n.closest("form")),"label"==n.dataset.value&&(n.closest("form").querySelector('[name="formfield[wrap]"]').checked=!0,n.closest("form").querySelector('[name="formfield[wrap]"]').defaultChecked=!0)),null!=n.closest(".equation")&&function(e){e.closest(".rule-row").querySelector('[name*="conditional_value"]').classList.remove("hidden"),e.closest(".rule-row").querySelectorAll(".equation_2, .conditional_field_2").forEach((function(e){e.classList.add("hidden")})),"-"==e.dataset.value||"+"==e.dataset.value?e.closest(".rule-row").querySelectorAll(".equation_2, .conditional_field_2").forEach((function(e){e.classList.remove("hidden")})):null!=e.dataset.value&&e.dataset.value.includes("value")?(e.closest(".rule-row").querySelector(".conditional_field_2").classList.remove("hidden"),e.closest(".rule-row").querySelector('[name*="conditional_value"]').classList.add("hidden")):null!=e.dataset.value&&(e.dataset.value.includes("changed")||e.dataset.value.includes("clicked")||e.dataset.value.includes("visible")||e.dataset.value.includes("invisible")||e.dataset.value.includes("checked"))&&e.closest(".rule-row").querySelector('[name*="conditional_value"]').classList.add("hidden")}(n),(n.classList.contains("and_rule")||n.classList.contains("or_rule"))&&async function(e){let t=e.closest(".condition-row"),l=e.closest(".rule-row"),o=l.querySelector(".active");if(null==o&&t.querySelectorAll(".rule-row").length>1&&l.dataset.rule_index!=t.querySelectorAll(".rule-row").length-1||null!=o&&!e.classList.contains("active")){let t="OR",n="AND",i=!0;if(null!=o){"AND"==o.textContent&&(t="AND",n="OR");let e={title:"What do you want to do?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:`Change ${t} to ${n}`,denyButtonText:"Add a new rule"};null!=document.fullscreenElement&&(e.target=document.fullscreenElement),result=await Swal.fire(e),result.isConfirmed?o.classList.remove("active"):result.isDenied&&(h(l),i=!1)}i&&(e.classList.add("active"),l.querySelector(".combinator").value=e.textContent)}else h(l),e.classList.add("active"),l.querySelector(".combinator").value=e.textContent}(n),n.classList.contains("add_condition")&&function(e){let t,l=e.closest(".condition-row");e.classList.contains("opposite")?(t=FormFunctions.cloneNode(l,!1),t=function(e,t){return e.querySelectorAll(".element_condition").forEach((function(e){if(e.matches("select:not(.nonice,.swal2-select)")&&Main.attachNiceSelect(select),"SELECT"==e.tagName&&e.classList.contains("equation")){FormFunctions.removeDefaultSelect(e);let l=t.closest(".condition-row").querySelector(".equation").selectedIndex;l&&(l%2?e.options[l+1].defaultSelected=!0:e.options[l-1].defaultSelected=!0),null!=e._niceSelect&&e._niceSelect.update()}else"radio"!=e.type||!e.classList.contains("element_condition")||"show"!=e.value&&"hide"!=e.value||(e.checked?e.checked=!1:e.checked=!0)})),e}(t,e)):t=FormFunctions.cloneNode(l);let o=parseInt(l.dataset.condition_index)+1;t.dataset.condition_index=o,e.classList.contains("opposite")||t.querySelectorAll(".active").forEach((function(e){e.classList.remove("active")}));let n={};if(l.querySelectorAll('input[type="radio"]:checked').forEach((e=>{n[e.value]=e.value})),l.parentNode.insertBefore(t,l.nextSibling),!e.classList.contains("opposite")){let e=t.querySelectorAll(".rule-row").length;t.querySelectorAll(".rule-row").forEach((function(t){t.dataset.rule_index!=e-1?t.remove():p(t.closest(".condition-row"))}))}y(),l.querySelectorAll('input[type="radio"]').forEach((e=>{null!=n[e.value]&&(e.checked=!0)})),e.style.display="none"}(n),n.classList.contains("remove_condition")&&function(e){let t=e.closest(".condition-row");if(t.querySelectorAll(".rule-row").length>1){let l={title:"What do you want to remove?",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"One condition rule",denyButtonText:"The whole condition",confirmButtonColor:"#bd2919"};null!=document.fullscreenElement&&(l.target=document.fullscreenElement),Swal.fire(l).then((l=>{if(l.isConfirmed){let l=e.closest(".rule-row"),o=parseInt(l.dataset.rule_index),n=t.querySelector('[data-rule_index="'+(o-1)+'"]');null!=n&&(null==t.querySelector(`[data-rule_index="${o+1}"]`)&&n.querySelectorAll(".active").forEach((e=>e.classList.remove("active"))),n.querySelector(".combinator").value=""),e.closest(".rule-row").remove(),p(t)}else l.isDenied&&(t.remove(),y())}))}else{let e={title:"Are you sure?",text:"This will remove this condition",icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"};null!=document.fullscreenElement&&(e.target=document.fullscreenElement),Swal.fire(e).then((e=>{e.isConfirmed&&(t.remove(),y())}))}}(n),n.classList.contains("showcopyfields")&&(n.checked?n.closest(".copyfieldswrapper").querySelector(".copyfields").classList.remove("hidden"):n.closest(".copyfieldswrapper").querySelector(".copyfields").classList.add("hidden")),n.classList.contains("emailtrigger")){let e=n.closest(".clone-div").querySelector(".conditionalfield-wrapper");"fieldchanged"==n.value?e.classList.remove("hidden"):e.classList.add("hidden"),e=n.closest(".clone-div").querySelector(".conditionalfields-wrapper"),"fieldschanged"==n.value?e.classList.remove("hidden"):e.classList.add("hidden"),e=n.closest(".clone-div").querySelector(".submitted-type"),"submittedcond"==n.value?e.classList.remove("hidden"):e.classList.add("hidden")}n.classList.contains("fromemail")&&function(e){let t=e.closest(".clone-div").querySelector(".emailfromfixed"),l=e.closest(".clone-div").querySelector(".emailfromconditional");"fixed"==e.value?(t.classList.remove("hidden"),l.classList.add("hidden")):(l.classList.remove("hidden"),t.classList.add("hidden"))}(n),n.classList.contains("emailto")&&function(e){let t=e.closest(".clone-div").querySelector(".emailtofixed"),l=e.closest(".clone-div").querySelector(".emailtoconditional");"fixed"==e.value?(t.classList.remove("hidden"),l.classList.add("hidden")):(l.classList.remove("hidden"),t.classList.add("hidden"))}(n),(n.classList.contains("placeholderselect")||n.classList.contains("placeholders"))&&function(e){let t="";if(e.classList.contains("placeholders")?t=e.textContent:""!=e.value&&(t=e.value,e.selectedIndex="0"),""!=t){let e={icon:"success",title:"Copied "+t,showConfirmButton:!1,timer:1500};null!=document.fullscreenElement&&(e.target=document.fullscreenElement),Swal.fire(e),navigator.clipboard.writeText(t)}}(n),n.matches(".warn_cond")&&function(e){let t=FormFunctions.cloneNode(e.closest(".warning_conditions"));e.closest(".conditions_wrapper").insertAdjacentElement("beforeEnd",t),e.classList.add("active"),e.closest(".warning_conditions").querySelector(".combinator").value=e.value,w(e.closest(".conditions_wrapper"))}(n),n.matches(".remove_warn_cond")&&function(e){let t=e.closest(".warning_conditions");null==t.nextElementSibling&&(t.previousElementSibling.querySelector(".active").classList.remove("active"),t.previousElementSibling.querySelector(".combinator").value=""),t.remove(),w(e.closest(".conditions_wrapper"))}(n),n.matches(".builder-permissions-rights-form")&&n.closest("div").querySelector(".permission-wrapper").classList.toggle("hidden")})),window.addEventListener("change",(e=>{let t=e.target;if(t.matches(".meta_key")){let e=t.list.querySelector(`[value='${t.value}' i]`);if(null!=e&&null!=e.dataset.keys){parent=t.closest(".warning_conditions").querySelector(".index_wrapper"),parent.classList.remove("hidden");let l=parent.querySelector(".meta_key_index_list");for(let e=1;e<l.options.length;e++)l.options[e].remove();e.dataset.keys.split(",").forEach((e=>{let t=document.createElement("option");t.value=e,l.appendChild(t)}))}}else if(t.matches(".condition-row [name*='[property_value]']")){let e=document.querySelector(`.form-element-wrapper[data-id="${t.value}"]`);if(null==e)return;let l=e.dataset.type;"number"==l?t.closest(".condition_form").querySelectorAll(".addition.hidden").forEach((e=>e.classList.remove("hidden"))):t.closest(".condition_form").querySelectorAll(".addition:not(.hidden)").forEach((e=>e.classList.add("hidden"))),"date"==l?t.closest(".condition_form").querySelectorAll(".addition .days.hidden").forEach((e=>e.classList.remove("hidden"))):t.closest(".condition_form").querySelectorAll(".addition .days:not(.hidden)").forEach((e=>e.classList.add("hidden")))}else if(t.matches("[name*='[submittedtrigger][equation]']")){let e=t.closest(".submitted-trigger-type"),l=e.querySelector(".staticvalue"),o=e.querySelector("div.dynamicvalue");null!=o&&("=="==t.value||"!="==t.value||">"==t.value||"<"==t.value?(l.classList.remove("hidden"),o.classList.add("hidden")):"checked"==t.value||"!checked"==t.value?(o.classList.add("hidden"),l.classList.add("hidden")):(o.classList.remove("hidden"),l.classList.add("hidden")))}else if(null!=t.name&&t.name.includes("[equation")){let e=t.closest(".warning_conditions");null!=e&&("submitted"==t.value?e.querySelector("[name*='[conditional_value]']").classList.add("hidden"):e.querySelector("[name*='[conditional_value]']").classList.remove("hidden"))}}))})();
//# sourceMappingURL=formbuilder.min.js.map