{"version":3,"file":"forms_table.min.js","mappings":"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","sources":["webpack://forms/./forms_table.js"],"sourcesContent":["/**\r\n * We need to be carefull with this script as it has overlap with the main table.js\r\n */\r\n\r\nconsole.log(\"Formstable.js loaded\");\r\n\r\nasync function showHiddenColumns(target){\r\n\t// store as preference\r\n\tlet formData\t= new FormData();\r\n\tformData.append('form-id', target.dataset.formId);\r\n\r\n\tlet response\t= await FormSubmit.fetchRestApi('forms/delete_table_prefs', formData);\r\n\r\n\tif(response){\r\n\t\tMain.displayMessage(response);\r\n\t\tlocation.reload();\r\n\t}\r\n}\r\n\r\nasync function saveColumnSettings(target){\r\n\tlet response = await FormSubmit.submitForm(target, 'forms/save_column_settings');\r\n\r\n\tif(response){\r\n\t\tMain.displayMessage(response);\r\n\t\tlocation.reload();\r\n\t}\r\n}\r\n\r\nasync function saveTableSettings(target){\r\n\tlet response = await FormSubmit.submitForm(target, 'forms/save_table_settings');\r\n\r\n\tif(response){\r\n\t\tMain.displayMessage(response);\r\n\t}\r\n}\r\n\r\nasync function askConfirmation(text){\r\n\tlet options\t= {\r\n\t\ttitle: 'Are you sure?',\r\n\t\ttext: `Are you sure you want to ${text} this?`,\r\n\t\ticon: 'warning',\r\n\t\tshowCancelButton: true,\r\n\t\tconfirmButtonColor: \"#bd2919\",\r\n\t\tcancelButtonColor: '#d33',\r\n\t\tconfirmButtonText: `Yes, ${text} it!`,\r\n\t};\r\n\r\n\tif(document.fullscreenElement != null){\r\n\t\toptions['target']\t= document.fullscreenElement;\r\n\t}\r\n\r\n\tlet result\t= await Swal.fire(options);\r\n\r\n\r\n\tdocument.fullscreenElement\r\n\r\n\treturn result.isConfirmed;\r\n}\r\n\r\nasync function removeSubmission(target){\r\n\tif(await askConfirmation('delete')){\t\t\r\n\t\tlet submissionId\t= target.closest('tr').dataset.id;\r\n\t\tlet table\t\t\t= target.closest('table');\r\n\r\n\t\tlet formData = new FormData();\r\n\t\tformData.append('form-id', table.dataset.formId);\r\n\t\tformData.append('submission-id', submissionId);\r\n\t\t\r\n\t\t//display loading gif\r\n\t\tMain.showLoader(target);\r\n\r\n\t\tlet response\t= await FormSubmit.fetchRestApi('forms/remove_submission', formData);\r\n\r\n\t\tif(response){\r\n\t\t\ttable.querySelectorAll(`.table-row[data-id=\"${submissionId}\"]`).forEach(\r\n\t\t\t\trow=>row.remove()\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nasync function archiveSubmission(target){\t\r\n\tlet table\t\t\t= target.closest('table');\r\n\tlet tableRow\t\t= target.closest('tr');\r\n\tlet submissionId\t= tableRow.dataset.id;\r\n\tlet showSwal\t\t= true;\r\n\tlet action\t\t\t= target.value;\r\n\tlet response;\r\n\r\n\tlet formData \t\t= new FormData();\r\n\tformData.append('form-id', table.dataset.formId);\r\n\tformData.append('submission-id', submissionId);\r\n\tformData.append('action', action);\r\n\t\r\n\t// Ask whether to archive one piece or the whole\r\n\tif(tableRow.dataset.subid != undefined){\r\n\t\tshowSwal = false;\r\n\r\n\t\tlet options\t= {\r\n\t\t\ttitle: `What do you want to ${action}?`,\r\n\t\t\ttext: `Do you want to ${action} just this one or the whole request?`,\r\n\t\t\ticon: 'question',\r\n\t\t\tshowDenyButton: true,\r\n\t\t\tshowCancelButton: true,\r\n\t\t\tconfirmButtonText: 'Just this one',\r\n\t\t\tdenyButtonText: 'The whole request',\r\n\t\t\tconfirmButtonColor: \"#bd2919\"\r\n\t\t};\r\n\t\r\n\t\tif(document.fullscreenElement != null){\r\n\t\t\toptions['target']\t= document.fullscreenElement;\r\n\t\t}\r\n\t\t\r\n\t\tresponse = await Swal.fire(options);\r\n\r\n\t\tif (response.isConfirmed) {\r\n\t\t\tformData.append('subid', tableRow.dataset.subid);\r\n\t\t}\r\n\t\t\r\n\t\t// skip if denied\r\n\t\tif(response.isDismissed){\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\t\r\n\tif(showSwal){\r\n\t\tif(!await askConfirmation(action)){\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\t//display loading gif\r\n\tMain.showLoader(target);\r\n\t\r\n\tresponse\t= await FormSubmit.fetchRestApi('forms/archive_submission', formData);\r\n\r\n\tif(response){\r\n\t\tlet params = new Proxy(new URLSearchParams(window.location.search), {\r\n\t\t\tget: (searchParams, prop) => searchParams.get(prop),\r\n\t\t});\r\n\r\n\t\t// Create a custom event so others can listen to it.\r\n\t\t// Used by bookings uploads\r\n\t\tconst event = new Event('submissionArchived');\r\n\t\t\r\n\t\t// Delete all\r\n\t\tif(formData.get('subid') == null){\r\n\t\t\ttable.querySelectorAll(`[data-id=\"${submissionId}\"]`).forEach(row=>{\r\n\t\t\t\trow.dispatchEvent(event);\r\n\r\n\t\t\t\t// just change the button name\r\n\t\t\t\tif(params.archived){\r\n\t\t\t\t\tlet element;\r\n\t\t\t\t\tif(action == 'archive'){\r\n\t\t\t\t\t\telement = row.querySelector(`.loader-wrapper, .archive`);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\telement = row.querySelector(`.loader-wrapper, .unarchive`);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tchangeArchiveButton(element, action);\r\n\t\t\t\t}else{\r\n\t\t\t\t\trow.remove();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t// Only delete subid\r\n\t\t}else{\r\n\t\t\ttable.querySelectorAll(`.table-row[data-id=\"${submissionId}\"][data-subid=\"${tableRow.dataset.subid}\"]`).forEach(row=>{\r\n\t\t\t\trow.dispatchEvent(event);\r\n\t\t\t\t\r\n\t\t\t\t// just change the button name\r\n\t\t\t\tif(params.archived){\r\n\t\t\t\t\tlet loader = row.querySelector('.loader-wrapper');\r\n\t\t\t\t\t\r\n\t\t\t\t\tchangeArchiveButton(loader, action);\r\n\t\t\t\t}else{\r\n\t\t\t\t\trow.remove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction changeArchiveButton(element, action){\r\n\tlet text;\r\n\r\n\tif(action == 'archive'){\r\n\t\taction \t= 'unarchive';\r\n\t\ttext\t= 'Unarchive';\r\n\t}else{\r\n\t\taction \t= 'archive';\r\n\t\ttext\t= 'Archive';\r\n\t}\r\n\telement.outerHTML = `<button class=\"${action} button forms-table-action\" name=\"${action}-action\" value=\"${action}\">${text}</button>`;\r\n}\r\n\r\nasync function getInputHtml(target){\r\n\tlet table\t\t\t= target.closest('table');\r\n\r\n\tlet formId\t\t\t= table.dataset.formId;\r\n    let submissionId\t= target.closest('tr').dataset.id;\r\n\tlet data\t\t\t= target.dataset;\r\n    \r\n    let loader\t\t\t= Main.showLoader(target.querySelector('.override-wrapper'), true);\r\n\r\n\tlet formData \t\t= new FormData();\r\n    formData.append('form-id', formId);\r\n    formData.append('submission-id', submissionId);\r\n    formData.append('element-id', data.elementId);\r\n\r\n\tfor( var d in data){\r\n\t\tformData.append(d, data[d]);\r\n\t}\r\n\r\n\tlet response\t= await FormSubmit.fetchRestApi('forms/get_input_html', formData);\r\n\r\n\tif(response){\r\n\t\tloader.outerHTML\t= `<div class='input-wrapper'>${response}</div>`;\r\n\r\n\t\ttarget.querySelectorAll('.file-upload-wrap').forEach(el=>el.addEventListener('uploadfinished', uploadFinished));\r\n\r\n\t\t// show calendar by default\r\n\t\ttarget.querySelectorAll('input').forEach(el=>el.showPicker());\r\n\t}else{\r\n\t\ttarget.innerHTML\t= target.dataset.oldHtml;\r\n\t\ttarget.classList.remove('active');\r\n\t}\r\n}\r\n\r\nfunction updatePageNav(navWrapper, pageNr){\r\n\r\n\tnavWrapper.querySelector('.current').classList.remove('current');\r\n\r\n\tnavWrapper.querySelector(`[data-nr=\"${pageNr}\"]`).classList.add('current');\r\n\r\n\t// hide prev button\r\n\tif(pageNr == 0){\r\n\t\tnavWrapper.querySelector('.prev').classList.add('hidden');\r\n\t}else{\r\n\t\tnavWrapper.querySelector('.prev').classList.remove('hidden');\r\n\t}\r\n\r\n\t// hide next button\r\n\tif(pageNr == navWrapper.querySelectorAll('.page-number').length -1){\r\n\t\tnavWrapper.querySelector('.next').classList.add('hidden');\r\n\t}else{\r\n\t\tnavWrapper.querySelector('.next').classList.remove('hidden');\r\n\t}\r\n}\r\n\r\nasync function getNextPage(target){\r\n\tlet wrapper\t\t\t= target.closest('.form.table-wrapper');\r\n\tlet navWrapper\t\t= target.closest('.form-result-navigation');\r\n\tlet tableWrapper\t= target.closest('.form-results-wrapper');\r\n\tlet table\t\t\t= tableWrapper.querySelector('.form-data-table:not(.hidden)');\r\n\r\n\ttable.classList.add('hidden');\r\n\r\n\t// get the requested page number\r\n\tlet\tcurPage\t\t\t= parseInt(navWrapper.querySelector(\".page-number-wrapper .current\").dataset.nr);\r\n\tlet page;\r\n\tif(target.matches('.next')){\r\n\t\tpage\t= curPage + 1;\r\n\t}else if(target.matches('.prev')){\r\n\t\tpage\t= curPage - 1;\r\n\t}else{\r\n\t\tpage\t= target.dataset.nr;\r\n\t}\r\n\t\r\n\tupdatePageNav(navWrapper, page);\r\n\r\n\t// check if the requested page is already loaded\r\n\tlet loadedPage\t= tableWrapper.querySelector(`[data-page=\"${page}\"]`);\r\n\t\r\n\tif(loadedPage != null){\r\n\t\tconsole.log(loadedPage);\r\n\t\tloadedPage.classList.remove('hidden');\r\n\r\n\t\treturn;\r\n\t}\r\n\r\n\t// request page over ajax\r\n\tlet formId\t\t\t= table.dataset.formId;\r\n\r\n\tlet loader\t\t\t= Main.showLoader(table, false);\r\n\tlet formData;\r\n\tif(wrapper.querySelector(\".filter-options\") == null){\r\n\t\tformData\t\t= new FormData();\r\n\t}else{\r\n\t\tformData\t\t= new FormData(wrapper.querySelector(\".filter-options\"));\r\n\t}\r\n\r\n    formData.append('form-id', formId);\r\n    formData.append('page-number', page);\r\n\tformData.append('shortcode-id', table.dataset.shortcodeId);\r\n    formData.append('type', table.dataset.type);\r\n\r\n\tlet params = new Proxy(new URLSearchParams(window.location.search), {\r\n\t\tget: (searchParams, prop) => searchParams.get(prop),\r\n\t});\r\n\r\n\tlet archived;\r\n\tif(params['archived'] == null){\r\n\t\tarchived\t= false;\r\n\t}else{\r\n\t\tarchived\t= true;\r\n\t}\r\n\r\n\tlet onlyOwn;\r\n\tif(params['onlyOwn'] == null){\r\n\t\tonlyOwn\t= false;\r\n\t}else{\r\n\t\tonlyOwn\t= true;\r\n\t}\r\n\tformData.append('archived', archived);\r\n\tformData.append('only-own', onlyOwn);\r\n\t\r\n\tif(tableWrapper.dataset.sortcol){\r\n\t\tformData.append('sortcol', tableWrapper.dataset.sortcol);\r\n\t}\r\n\r\n\tif(tableWrapper.dataset.sortdir){\r\n\t\tformData.append('sortdir', tableWrapper.dataset.sortdir);\r\n\t}\r\n\r\n\tlet response\t= await FormSubmit.fetchRestApi('forms/get_page', formData);\r\n\r\n\tif(response){\r\n\t\tloader.outerHTML\t= response;\r\n\t}else{\r\n\t\t// restore prev data\r\n\t\ttable.classList.remove('hidden');\r\n\r\n\t\tloader.remove();\r\n\r\n\t\tupdatePageNav(navWrapper, curPage);\r\n\t}\r\n}\r\n\r\nasync function getSortedPage(target){\r\n\t\r\n\tlet wrapper\t\t\t= target.closest('.form.table-wrapper');\r\n\tlet tableWrapper\t= target.closest('.form-results-wrapper');\r\n\r\n\t// always start at page 1 again after sorting\r\n\tlet navWrapper\t\t= tableWrapper.querySelector('.form-result-navigation');\r\n\tupdatePageNav(navWrapper, 0);\r\n\r\n\tlet table\t\t\t= tableWrapper.querySelector('.form-data-table:not(.hidden)');\r\n\tlet formId\t\t\t= table.dataset.formId;\r\n\tlet sortCol\t\t\t= target.id;\r\n\tlet sortDir\t\t\t= target.classList.contains('desc') ? 'DESC' : 'ASC';\r\n\r\n\ttableWrapper.dataset.sortcol\t= sortCol;\r\n\ttableWrapper.dataset.sortdir\t= sortDir;\r\n\r\n\tlet loader\t\t\t= Main.showLoader(table, true, 50, 'Loading sorted data');\r\n\tlet formData;\r\n\tif(wrapper.querySelector(\".filter-options\") == null){\r\n\t\tformData\t\t= new FormData();\r\n\t}else{\r\n\t\tformData\t\t= new FormData(wrapper.querySelector(\".filter-options\"));\r\n\t}\r\n\r\n    formData.append('form-id', formId);\r\n    formData.append('page-number', 0);\r\n\tformData.append('shortcode-id', table.dataset.shortcodeId);\r\n    formData.append('type', table.dataset.type);\r\n\r\n\tlet params = new Proxy(new URLSearchParams(window.location.search), {\r\n\t\tget: (searchParams, prop) => searchParams.get(prop),\r\n\t});\r\n\r\n\tlet archived;\r\n\tif(params['archived'] == null){\r\n\t\tarchived\t= false;\r\n\t}else{\r\n\t\tarchived\t= true;\r\n\t}\r\n\r\n\tlet onlyOwn;\r\n\tif(params['onlyOwn'] == null){\r\n\t\tonlyOwn\t= false;\r\n\t}else{\r\n\t\tonlyOwn\t= true;\r\n\t}\r\n\tformData.append('archived', archived);\r\n\tformData.append('only-own', onlyOwn);\r\n\tformData.append('sortcol', sortCol);\r\n\tformData.append('sortdir', sortDir);\r\n\r\n\tlet response\t= await FormSubmit.fetchRestApi('forms/get_page', formData);\r\n\r\n\tif(response){\r\n\t\tloader.outerHTML\t= response;\r\n\t}else{\r\n\t\t// restore prev data\r\n\t\ttable.classList.remove('hidden');\r\n\r\n\t\tloader.remove();\r\n\t}\r\n}\r\n\r\nfunction uploadFinished(event){\r\n\tif(event.target.closest('td') != null){\r\n\t\t//remove as soon as we come here\r\n\t\tdocument.removeEventListener('uploadfinished', uploadFinished);\r\n\t\tprocessFormsTableInput(document.querySelector('[data-oldText]'));\r\n\t}\r\n}\r\n\r\n//function to get the temp input value and save it over AJAX\r\nasync function processFormsTableInput(target){\r\n\t// Do not proceed if this is a schedule table\r\n\tif( target.closest('.schedule') != null ){\r\n\t\treturn;\r\n\t}\r\n\r\n\tlet table\t\t\t= target.closest('table');\r\n\tlet submissionId\t= target.closest('tr').dataset.id;\r\n\tlet cell\t\t\t= target.closest('td');\r\n    let data\t\t\t= cell.dataset;\r\n\tlet value\t\t\t= FormFunctions.getFieldValue(target, cell, false);\r\n\tlet shortcodeId\t\t= '';\r\n\r\n\tif(target.closest('[data-shortcode-id]') != null){\r\n\t\tshortcodeId\t= target.closest('[data-shortcode-id]').dataset.shortcodeId;\r\n\t}\r\n\r\n\t//Only update when needed\r\n\tif (value != JSON.parse(cell.dataset.oldvalue)){\r\n\t\tMain.showLoader(cell.querySelector('.input-wrapper'));\r\n\t\t\r\n\t\t// Submit new value and receive the filtered value back\r\n\t\tlet formData = new FormData();\r\n\t\tformData.append('submission-id', submissionId);\r\n\r\n\t\tfor(d in data){\r\n\t\t\tformData.append(d, data[d]);\r\n\t\t}\r\n\t\tformData.append('new-value', JSON.stringify(value));\r\n\r\n\t\tif(shortcodeId != ''){\r\n\t\t\tformData.append('shortcode-id', shortcodeId);\r\n\t\t}\r\n\t\t\r\n\t\tlet response\t= await FormSubmit.fetchRestApi('forms/edit_value', formData);\r\n\t\r\n\t\tif(response){\r\n\t\t\ttarget.classList.remove('editing');\r\n\r\n\t\t\tlet newValue = response['new-value'];\r\n\t\t\t\r\n\t\t\tif(typeof(newValue) == 'string'){\r\n\t\t\t\tnewValue.replace('_', ' ');\r\n\t\t\t}\r\n\r\n\t\t\t//Replace the input element with its value\r\n\t\t\tif(newValue == \"\"){\r\n\t\t\t\tnewValue = \"X\";\r\n\t\t\t}\r\n\t\r\n\t\t\t//Update all occurences of this field\r\n\t\t\tif(data['subid'] == undefined){\r\n\t\t\t\tlet targets\t= table.querySelectorAll(`tr[data-id=\"${submissionId}\"] td[data-id=\"${data['id']}\"]`);\r\n\t\t\t\ttargets.forEach(td=>{td.innerHTML = newValue;});\r\n\t\t\t}else{\r\n\t\t\t\tcell.innerHTML = newValue;\r\n\t\t\t}\r\n\r\n\t\t\tcell.dataset.oldvalue\t \t= JSON.stringify(newValue);\r\n\t\r\n\t\t\tMain.displayMessage(response.message.replace('_', ' '));\r\n\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\t// Restore the old value\r\n\tcell.innerHTML = cell.dataset.oldHtml;\r\n}\r\n\r\nconst copyContent = async (target) => {\r\n\tlet text\t= target.closest('td').innerText;\r\n    try {\r\n\t\tlet options = {\r\n\t\t\ticon: 'success',\r\n\t\t\ttitle: `Copied '${text}'`,\r\n\t\t\tshowConfirmButton: false,\r\n\t\t\ttimer: 3000\r\n\t\t};\r\n\r\n\t\tSwal.fire(options);\r\n\r\n\t\tnavigator.clipboard.writeText(text);\r\n    } catch (err) {\r\n\t\tMain.displayMessage('Failed to copy: '+err, 'error');\r\n    }\r\n}\r\n\r\nconst hideColumn\t= async (target) => {\r\n\tif(target.tagName == 'SPAN'){\r\n\t\ttarget = target.querySelector('img');\r\n\t}\r\n\r\n\t// Table itself\r\n\tif(target.parentNode.matches('th')){\r\n\t\tlet cell \t= target.parentNode;\r\n\r\n\t\t// Hide the column\r\n\t\tvar table\t\t= cell.closest('table');\r\n\r\n\t\t// store as preference\r\n\t\tvar formData\t= new FormData();\r\n\t\tformData.append('form-id', table.dataset.formId);\r\n\t\tformData.append('column-name', cell.id);\r\n\t\t\r\n\t\tawait FormSubmit.fetchRestApi('forms/save_table_prefs', formData);\r\n\t// Table settings\r\n\t}else{\r\n\t\tif(target.classList.contains('visible')){\r\n\t\t\ttarget.classList.replace('visible', 'invisible');\r\n\t\t\ttarget.src\t= target.src.replace('visible.png', 'invisible.png');\r\n\t\t\ttarget.closest('td').querySelector('input').value = 0;\r\n\t\t}else{\r\n\t\t\ttarget.classList.replace('invisible','visible');\r\n\t\t\ttarget.src\t= target.src.replace('invisible.png','visible.png');\r\n\t\t\ttarget.closest('td').querySelector('input').value = 1;\r\n\t\t}\r\n\t}\r\n}\r\n\r\ndocument.addEventListener(\"click\", event=>{\r\n\tlet target \t\t= event.target;\r\n\tlet td \t\t\t= target.closest('td');\r\n\tlet activeCell\t= document.querySelector('td.active');\r\n\r\n\tif(target.name == 'submit_column_setting'){\r\n\t\tsaveColumnSettings(target);\r\n\t}else if(target.name == 'submit_table_setting'){\r\n\t\tsaveTableSettings(target);\r\n\t}else if(target.name == 'form-settings[autoarchive]'){\r\n\t\t//show auto archive fields\r\n\t\tlet el = target.closest('.table-rights-wrapper').querySelector('.auto-archive-logic');\r\n\t\tif(target.value == '1'){\r\n\t\t\tel.classList.remove('hidden');\r\n\t\t}else{\r\n\t\t\tel.classList.add('hidden');\r\n\t\t}\r\n\t}else if(target.closest('.form-result-navigation') != null && (target.matches('.next') || target.matches('.prev') || target.matches('.page-number'))){\r\n\t\tgetNextPage(target);\r\n\t}\r\n\r\n\telse if(target.tagName == 'TH' && target.closest(\".form-results-wrapper\").querySelector('.form-result-navigation') != null){\r\n\t\t// get a sorted table over AJAX\r\n\t\tgetSortedPage(target);\r\n\t}\r\n\r\n\t// copy cell contents\r\n\telse if(target.matches('.copy')){\r\n\t\tcopyContent(target);\r\n\t}\r\n\r\n\t//Actions\r\n\telse if(target.matches('.delete.forms-table-action')){\r\n\t\tremoveSubmission(target);\r\n\t}\r\n\r\n\telse if(target.matches('.archive.forms-table-action, .unarchive.forms-table-action')){\r\n\t\tarchiveSubmission(target);\r\n\t}\r\n\r\n\telse if(target.matches('.print.forms-table-action')){\r\n\t\twindow.location.href = window.location.href.split('?')[0]+\"?print=true&table_id=\"+table.dataset.id+\"&submission_id=\"+table_row.querySelector(\"[id='id' i]\").textContent;\r\n\t}\r\n\t\r\n\t//Open settings modal\r\n\telse if(target.classList.contains('edit-formshortcode-settings')){\r\n\t\tMain.showModal(document.querySelector('.modal.form-shortcode-settings'));\r\n\t}\r\n\r\n\telse if(target.matches('form .table-permissions-rights-form')){\r\n\t\ttarget.closest('div').querySelector('.permission-wrapper').classList.toggle('hidden');\r\n\t}\r\n\r\n\t//Hide column\r\n\telse if(target.classList.contains('visibility-icon')){\r\n\t\thideColumn(target);\r\n\t}\r\n\r\n\telse if(target.matches('.reset-col-vis')){\r\n\t\tshowHiddenColumns(target);\r\n\t}else{\r\n\t\treturn;\r\n\t}\r\n\r\n\tevent.stopImmediatePropagation();\r\n});\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function() {\r\n\t\r\n\tif(typeof(Sortable) != 'undefined'){\r\n\t\t//Make the sortable-column-settings-rows div sortable\r\n\t\tlet options = {\r\n\t\t\thandle: '.movecontrol',\r\n\t\t\tanimation: 150,\r\n\t\t};\r\n\r\n\t\tdocument.querySelectorAll('.sortable-column-settings-rows tbody').forEach(el=>{\r\n\t\t\tSortable.create(el, options);\r\n\t\t});\r\n\t}\r\n\r\n\tdocument.querySelectorAll('.form-data-table th').forEach(cell=>{\r\n\t\tcell.style.minWidth\t\t= parseFloat(window.getComputedStyle(cell).width) + 20 + 'px';\r\n\t});\r\n});\r\n\r\ndocument.addEventListener('change', event=>{\r\n\tlet target = event.target;\r\n\r\n\tif(target.id == 'sim-forms-selector'){\r\n\t\tdocument.querySelectorAll('.main-form-wrapper').forEach(el=>{\r\n\t\t\tel.classList.add('hidden');\r\n\t\t});\r\n\r\n\t\tdocument.getElementById(target.value).classList.remove('hidden');\r\n\r\n\t\t// position table\r\n\t\tSimTableFunctions.positionTable();\r\n\t}else{\r\n\t\treturn;\r\n\t}\r\n\r\n\tevent.stopImmediatePropagation();\r\n});\r\n\r\ndocument.addEventListener(\"table-content-update-inputs-loaded\", async event => {\r\n\tlet target\t= event.target;\r\n\r\n\tif( target.matches('.forms-table:not(.active, .copy)')){\r\n\t\tawait getInputHtml(target);\r\n\t}\r\n});\r\n\r\ndocument.addEventListener(\"table-content-before-update\", event => {\r\n\tlet target\t= event.target;\r\n\r\n\tprocessFormsTableInput(target);\r\n});"],"names":["async","askConfirmation","text","options","title","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","document","fullscreenElement","result","Swal","fire","isConfirmed","changeArchiveButton","element","action","outerHTML","updatePageNav","navWrapper","pageNr","querySelector","classList","remove","add","querySelectorAll","length","uploadFinished","event","target","closest","removeEventListener","processFormsTableInput","table","submissionId","dataset","id","cell","data","value","FormFunctions","getFieldValue","shortcodeId","JSON","parse","oldvalue","Main","showLoader","formData","FormData","d","append","stringify","response","FormSubmit","fetchRestApi","newValue","replace","undefined","forEach","td","innerHTML","displayMessage","message","oldHtml","console","log","addEventListener","name","submitForm","location","reload","saveColumnSettings","saveTableSettings","el","matches","wrapper","tableWrapper","page","curPage","parseInt","nr","loadedPage","formId","loader","type","archived","onlyOwn","params","Proxy","URLSearchParams","window","search","get","searchParams","prop","sortcol","sortdir","getNextPage","tagName","sortCol","sortDir","contains","getSortedPage","innerText","showConfirmButton","timer","navigator","clipboard","writeText","err","copyContent","row","removeSubmission","tableRow","showSwal","subid","showDenyButton","denyButtonText","isDismissed","Event","dispatchEvent","archiveSubmission","href","split","table_row","textContent","showModal","toggle","parentNode","src","hideColumn","showHiddenColumns","stopImmediatePropagation","handle","animation","Sortable","create","style","minWidth","parseFloat","getComputedStyle","width","getElementById","SimTableFunctions","positionTable","elementId","showPicker","getInputHtml"],"sourceRoot":""}