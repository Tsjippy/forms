(()=>{async function e(e){let t={title:"Are you sure?",text:`Are you sure you want to ${e} this?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:`Yes, ${e} it!`};null!=document.fullscreenElement&&(t.target=document.fullscreenElement);let a=await Swal.fire(t);return document.fullscreenElement,a.isConfirmed}function t(e,t){let a;"archive"==t?(t="unarchive",a="Unarchive"):(t="archive",a="Archive"),e.outerHTML=`<button class="${t} button forms-table-action" name="${t}-action" value="${t}">${a}</button>`}async function a(e,t=0){let a=e.closest(".form.table-wrapper"),s=e.closest(".form-result-navigation"),o=e.closest(".form-results-wrapper");null==o&&(o=a.querySelector(".form-results-wrapper"));let r,n=o.querySelector(".form-data-table:not(.hidden)"),l=n.dataset.formId,i=n.dataset.shortcodeId,d=n.dataset.type;if(null!=s){!function(e,t){e.querySelector(".current").classList.remove("current"),e.querySelector(`[data-nr="${t}"]`).classList.add("current"),0==t?e.querySelector(".prev").classList.add("hidden"):e.querySelector(".prev").classList.remove("hidden"),t==e.querySelectorAll(".page-number").length-1?e.querySelector(".next").classList.add("hidden"):e.querySelector(".next").classList.remove("hidden")}(s,t);let e=o.querySelector(`[data-page="${t}"]`);if(null!=e)return void e.classList.remove("hidden");n.classList.add("hidden"),Main.showLoader(n,!1,100,"Loading data")}else d="all",a.querySelectorAll(".form-results-wrapper").forEach((e=>{e.classList.add(e.querySelector("table").dataset.type),e.innerHTML=Main.showLoader(e,!0,100,"Loading data",!0)}));r=null==a.querySelector(".filter-options")?new FormData:new FormData(a.querySelector("form.filter-options")),r.append("form-id",l),r.append("page-number",t),r.append("shortcode-id",i),r.append("type",d);let c,u,m=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});c=null==m.archived?0:1,u=null==m.onlyOwn?0:1,r.append("archived",c),r.append("only-own",u),o.dataset.sortcol&&r.append("sortcol",o.dataset.sortcol),o.dataset.sortdir&&r.append("sortdir",o.dataset.sortdir);let p=await FormSubmit.fetchRestApi("forms/get_page",r);if(p)for(const[e,t]of Object.entries(p))a.querySelector(`.form-results-wrapper.${e}`).outerHTML=t;else location.href=location.href}function s(e){e.querySelectorAll(".file-upload-wrap").forEach((e=>e.addEventListener("uploadfinished",o))),e.querySelectorAll("select").forEach((e=>{null==e._niceSelect&&Main.attachNiceSelect(e)})),e.querySelector("input, select, textarea").focus(),e.querySelector("button.save").classList.remove("hidden")}function o(e){null!=e.target.closest("td")&&(document.removeEventListener("uploadfinished",o),r(document.querySelector("[data-oldText]")))}async function r(e){if(null!=e.closest(".schedule"))return;let t=e.closest("table"),a=e.closest("td"),s=a.dataset,o=e.closest("tr").dataset.submissionId,r=FormFunctions.getFieldValue(e,a,!1),n="";if(null!=e.closest("[data-shortcode-id]")&&(n=e.closest("[data-shortcode-id]").dataset.shortcodeId),r!=s.oldText){a.querySelector("button.save").classList.add("hidden"),Main.showLoader(a.querySelector(".input-wrapper"),!0,50,"Saving...");let l=new FormData;l.append("submission-id",o),l.append("element-id",s.elementId),l.append("new-value",JSON.stringify(r)),null!=s.subid&&l.append("subid",s.subid),""!=n&&l.append("shortcode-id",n);let i=await FormSubmit.fetchRestApi("forms/edit_value",l);if(i){e.classList.remove("editing");let r=i["new-value"];return"string"==typeof r&&r.replace("_"," "),""==r&&(r="X"),null!=s.subid?t.querySelectorAll(`tr[data-submission-id="${o}"] td[data-element-id="${s.elementId}"]`).forEach((e=>{e.innerHTML=r})):a.innerHTML=r,void Main.displayMessage(i.message.replace("_"," "))}}a.innerHTML=a.dataset.oldHtml}console.log("Formstable.js loaded"),document.addEventListener("click",(s=>{let o=s.target;if("submit_column_setting"==o.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_column_settings");t&&(Main.displayMessage(t),location.reload())}(o);else if("submit_table_setting"==o.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_table_settings");t&&Main.displayMessage(t)}(o);else if("form-settings[autoarchive]"==o.name){let e=o.closest(".table-rights-wrapper").querySelector(".auto-archive-logic");"1"==o.value?e.classList.remove("hidden"):e.classList.add("hidden")}else if(null!=o.closest(".form-result-navigation")&&(o.matches(".next")||o.matches(".prev")||o.matches(".page-number"))){let e,t=parseInt(navWrapper.querySelector(".page-number-wrapper .current").dataset.nr);e=o.matches(".next")?t+1:o.matches(".prev")?t-1:o.dataset.nr,a(o,e)}else if("TH"==o.tagName&&null!=o.closest(".form-results-wrapper").querySelector(".form-result-navigation")){let e=o.id,t=o.classList.contains("desc")?"DESC":"ASC";tableWrapper.dataset.sortcol=e,tableWrapper.dataset.sortdir=t,a(o)}else if(o.matches(".button.filter-results"))a(o);else if(o.matches(".copy"))(async e=>{let t=e.closest("td").innerText;try{let e={icon:"success",title:`Copied '${t}'`,showConfirmButton:!1,timer:3e3};Swal.fire(e),navigator.clipboard.writeText(t)}catch(e){Main.displayMessage("Failed to copy: "+e,"error")}})(o);else if(o.matches(".delete.forms-table-action"))!async function(t){if(await e("delete")){let e=t.closest("tr").dataset.submissionId,a=t.closest("table"),s=new FormData;s.append("form-id",a.dataset.formId),s.append("submission-id",e),Main.showLoader(t),await FormSubmit.fetchRestApi("forms/remove_submission",s)&&a.querySelectorAll(`.table-row[data-submission-id="${e}"]`).forEach((e=>e.remove()))}}(o);else if(o.matches(".archive.forms-table-action, .unarchive.forms-table-action"))!async function(a){let s,o=a.closest("table"),r=a.closest("tr"),n=r.dataset.submissionId,l=!0,i=a.value,d=new FormData;if(d.append("form-id",o.dataset.formId),d.append("submission-id",n),d.append("action",i),null!=r.dataset.subid){l=!1;let e={title:`What do you want to ${i}?`,text:`Do you want to ${i} just this one or the whole request?`,icon:"question",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Just this one",denyButtonText:"The whole request",confirmButtonColor:"#bd2919"};if(null!=document.fullscreenElement&&(e.target=document.fullscreenElement),s=await Swal.fire(e),s.isConfirmed&&d.append("subid",r.dataset.subid),s.isDismissed)return}if((!l||await e(i))&&(Main.showLoader(a),s=await FormSubmit.fetchRestApi("forms/archive_submission",d),s)){let e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});const a=new Event("submissionArchived");null==d.get("subid")?o.querySelectorAll(`[data-submission-id="${n}"]`).forEach((s=>{if(s.dispatchEvent(a),e.archived){let e;e="archive"==i?s.querySelector(".loader-wrapper, .archive"):s.querySelector(".loader-wrapper, .unarchive"),t(e,i)}else s.remove()})):o.querySelectorAll(`.table-row[data-submission-id="${n}"][data-subid="${r.dataset.subid}"]`).forEach((s=>{s.dispatchEvent(a),e.archived?t(s.querySelector(".loader-wrapper"),i):s.remove()}))}}(o);else if(o.classList.contains("edit-formshortcode-settings"))Main.showModal(document.querySelector(".modal.form-shortcode-settings"));else if(o.matches("form .table-permissions-rights-form"))o.closest("div").querySelector(".permission-wrapper").classList.toggle("hidden");else{if(!o.matches(".reset-col-vis"))return;!async function(e){let t=new FormData;t.append("form-id",e.dataset.formId);let a=await FormSubmit.fetchRestApi("forms/delete_table_prefs",t);a&&(Main.displayMessage(a),location.reload())}(o)}s.stopImmediatePropagation()})),document.addEventListener("DOMContentLoaded",(function(){if("undefined"!=typeof Sortable){let e={handle:".movecontrol",animation:150};document.querySelectorAll(".sortable-column-settings-rows tbody").forEach((t=>{Sortable.create(t,e)}))}document.querySelectorAll(".form-data-table th").forEach((e=>{e.style.minWidth=parseFloat(window.getComputedStyle(e).width)+20+"px"}))})),document.addEventListener("change",(e=>{let t=e.target;"sim-forms-selector"==t.id&&(document.querySelectorAll(".main-form-wrapper").forEach((e=>{e.classList.add("hidden")})),document.getElementById(t.value).classList.remove("hidden"),SimTableFunctions.positionTable(),e.stopImmediatePropagation())})),document.addEventListener("table-content-update-inputs-loaded",(async e=>{let t=e.target;t.matches(".forms-table")&&(e.preventDefault(),await async function(e){let t=e.dataset,a=e.closest("tr").dataset.submissionId,o=e.closest("table").dataset.shortcodeId,r=Main.showLoader(e.querySelector(".override-wrapper"),!0,50,"Loading..."),n=new FormData;null!=t.subid&&n.append("subid",t.subid),n.append("submission-id",a),n.append("shortcode-id",o),n.append("element-id",t.elementId);let l=await FormSubmit.fetchRestApi("forms/get_input_html",n);l?(r.outerHTML=`<div class='input-wrapper'>${l}</div>`,s(e)):(e.innerHTML=e.dataset.oldHtml,e.classList.remove("editing"))}(t),s(t))})),document.addEventListener("table-content-before-update",(async e=>{let t=e.target;t.matches(".forms-table")&&(e.preventDefault(),r(t))})),document.addEventListener("table-content-before-column-hide",(async e=>{let t=e.target;null==t.closest(".column-setting-wrapper")&&null==t.closest(".form-data-table")||(e.preventDefault(),(async e=>{if(e.parentNode.matches("th")){let s=e.parentNode;var t=s.closest("table");let o=t.rows;for(const e of o)e.cells[s.cellIndex].classList.add("hidden");var a=new FormData;a.append("form-id",t.dataset.formId),a.append("column-name",s.id),await FormSubmit.fetchRestApi("forms/save_table_prefs",a)}else e.classList.contains("visible")?(e.classList.replace("visible","invisible"),e.src=e.src.replace("visible.png","invisible.png"),e.closest("td").querySelector("input").value=0):(e.classList.replace("invisible","visible"),e.src=e.src.replace("invisible.png","visible.png"),e.closest("td").querySelector("input").value=1)})(t))}))})();
//# sourceMappingURL=forms_table.min.js.map