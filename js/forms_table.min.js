(()=>{async function e(e){let t={title:"Are you sure?",text:`Are you sure you want to ${e} this?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:`Yes, ${e} it!`};null!=document.fullscreenElement&&(t.target=document.fullscreenElement);let a=await Swal.fire(t);return document.fullscreenElement,a.isConfirmed}function t(e,t){let a;"archive"==t?(t="unarchive",a="Unarchive"):(t="archive",a="Archive"),e.outerHTML=`<button class="${t} button forms-table-action" name="${t}-action" value="${t}">${a}</button>`}function a(e,t){e.querySelector(".current").classList.remove("current"),e.querySelector(`[data-nr="${t}"]`).classList.add("current"),0==t?e.querySelector(".prev").classList.add("hidden"):e.querySelector(".prev").classList.remove("hidden"),t==e.querySelectorAll(".page-number").length-1?e.querySelector(".next").classList.add("hidden"):e.querySelector(".next").classList.remove("hidden")}function o(e){null!=e.target.closest("td")&&(document.removeEventListener("uploadfinished",o),s(document.querySelector("[data-oldText]")))}async function s(e){if(null!=e.closest(".schedule"))return;let t=e.closest("table"),a=e.closest("tr").dataset.id,o=e.closest("td"),s=o.dataset,r=FormFunctions.getFieldValue(e,o,!1),i="";if(null!=e.closest("[data-shortcode-id]")&&(i=e.closest("[data-shortcode-id]").dataset.shortcodeId),r!=JSON.parse(o.dataset.oldvalue)){Main.showLoader(o.querySelector(".input-wrapper"));let n=new FormData;for(d in n.append("submission-id",a),s)n.append(d,s[d]);n.append("new-value",JSON.stringify(r)),""!=i&&n.append("shortcode-id",i);let l=await FormSubmit.fetchRestApi("forms/edit_value",n);if(l){e.classList.remove("editing");let r=l["new-value"];return"string"==typeof r&&r.replace("_"," "),""==r&&(r="X"),null==s.subid?t.querySelectorAll(`tr[data-id="${a}"] td[data-id="${s.id}"]`).forEach((e=>{e.innerHTML=r})):o.innerHTML=r,o.dataset.oldvalue=JSON.stringify(r),void Main.displayMessage(l.message.replace("_"," "))}}o.innerHTML=o.dataset.oldHtml}console.log("Formstable.js loaded"),document.addEventListener("click",(o=>{let s=o.target;if(s.closest("td"),document.querySelector("td.active"),"submit_column_setting"==s.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_column_settings");t&&(Main.displayMessage(t),location.reload())}(s);else if("submit_table_setting"==s.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_table_settings");t&&Main.displayMessage(t)}(s);else if("form-settings[autoarchive]"==s.name){let e=s.closest(".table-rights-wrapper").querySelector(".auto-archive-logic");"1"==s.value?e.classList.remove("hidden"):e.classList.add("hidden")}else if(null!=s.closest(".form-result-navigation")&&(s.matches(".next")||s.matches(".prev")||s.matches(".page-number")))!async function(e){let t=e.closest(".form.table-wrapper"),o=e.closest(".form-result-navigation"),s=e.closest(".form-results-wrapper"),r=s.querySelector(".form-data-table:not(.hidden)");r.classList.add("hidden");let i,n=parseInt(o.querySelector(".page-number-wrapper .current").dataset.nr);i=e.matches(".next")?n+1:e.matches(".prev")?n-1:e.dataset.nr,a(o,i);let l=s.querySelector(`[data-page="${i}"]`);if(null!=l)return console.log(l),void l.classList.remove("hidden");let d,c=r.dataset.formId,u=Main.showLoader(r,!1);d=null==t.querySelector(".filter-options")?new FormData:new FormData(t.querySelector(".filter-options")),d.append("form-id",c),d.append("page-number",i),d.append("shortcode-id",r.dataset.shortcodeId),d.append("type",r.dataset.type);let m,p,f=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});m=null!=f.archived,p=null!=f.onlyOwn,d.append("archived",m),d.append("only-own",p),s.dataset.sortcol&&d.append("sortcol",s.dataset.sortcol),s.dataset.sortdir&&d.append("sortdir",s.dataset.sortdir);let h=await FormSubmit.fetchRestApi("forms/get_page",d);h?u.outerHTML=h:(r.classList.remove("hidden"),u.remove(),a(o,n))}(s);else if("TH"==s.tagName&&null!=s.closest(".form-results-wrapper").querySelector(".form-result-navigation"))!async function(e){let t=e.closest(".form.table-wrapper"),o=e.closest(".form-results-wrapper");a(o.querySelector(".form-result-navigation"),0);let s=o.querySelector(".form-data-table:not(.hidden)"),r=s.dataset.formId,i=e.id,n=e.classList.contains("desc")?"DESC":"ASC";o.dataset.sortcol=i,o.dataset.sortdir=n;let l,d=Main.showLoader(s,!0,50,"Loading sorted data");l=null==t.querySelector(".filter-options")?new FormData:new FormData(t.querySelector(".filter-options")),l.append("form-id",r),l.append("page-number",0),l.append("shortcode-id",s.dataset.shortcodeId),l.append("type",s.dataset.type);let c,u,m=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});c=null!=m.archived,u=null!=m.onlyOwn,l.append("archived",c),l.append("only-own",u),l.append("sortcol",i),l.append("sortdir",n);let p=await FormSubmit.fetchRestApi("forms/get_page",l);p?d.outerHTML=p:(s.classList.remove("hidden"),d.remove())}(s);else if(s.matches(".copy"))(async e=>{let t=e.closest("td").innerText;try{let e={icon:"success",title:`Copied '${t}'`,showConfirmButton:!1,timer:3e3};Swal.fire(e),navigator.clipboard.writeText(t)}catch(e){Main.displayMessage("Failed to copy: "+e,"error")}})(s);else if(s.matches(".delete.forms-table-action"))!async function(t){if(await e("delete")){let e=t.closest("tr").dataset.id,a=t.closest("table"),o=new FormData;o.append("form-id",a.dataset.formId),o.append("submission-id",e),Main.showLoader(t),await FormSubmit.fetchRestApi("forms/remove_submission",o)&&a.querySelectorAll(`.table-row[data-id="${e}"]`).forEach((e=>e.remove()))}}(s);else if(s.matches(".archive.forms-table-action, .unarchive.forms-table-action"))!async function(a){let o,s=a.closest("table"),r=a.closest("tr"),i=r.dataset.id,n=!0,l=a.value,d=new FormData;if(d.append("form-id",s.dataset.formId),d.append("submission-id",i),d.append("action",l),null!=r.dataset.subid){n=!1;let e={title:`What do you want to ${l}?`,text:`Do you want to ${l} just this one or the whole request?`,icon:"question",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Just this one",denyButtonText:"The whole request",confirmButtonColor:"#bd2919"};if(null!=document.fullscreenElement&&(e.target=document.fullscreenElement),o=await Swal.fire(e),o.isConfirmed&&d.append("subid",r.dataset.subid),o.isDismissed)return}if((!n||await e(l))&&(Main.showLoader(a),o=await FormSubmit.fetchRestApi("forms/archive_submission",d),o)){let e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});const a=new Event("submissionArchived");null==d.get("subid")?s.querySelectorAll(`[data-id="${i}"]`).forEach((o=>{if(o.dispatchEvent(a),e.archived){let e;e="archive"==l?o.querySelector(".loader-wrapper, .archive"):o.querySelector(".loader-wrapper, .unarchive"),t(e,l)}else o.remove()})):s.querySelectorAll(`.table-row[data-id="${i}"][data-subid="${r.dataset.subid}"]`).forEach((o=>{o.dispatchEvent(a),e.archived?t(o.querySelector(".loader-wrapper"),l):o.remove()}))}}(s);else if(s.matches(".print.forms-table-action"))window.location.href=window.location.href.split("?")[0]+"?print=true&table_id="+table.dataset.id+"&submission_id="+table_row.querySelector("[id='id' i]").textContent;else if(s.classList.contains("edit-formshortcode-settings"))Main.showModal(document.querySelector(".modal.form-shortcode-settings"));else if(s.matches("form .table-permissions-rights-form"))s.closest("div").querySelector(".permission-wrapper").classList.toggle("hidden");else if(s.classList.contains("visibility-icon"))(async e=>{if("SPAN"==e.tagName&&(e=e.querySelector("img")),e.parentNode.matches("th")){let o=e.parentNode;var t=o.closest("table"),a=new FormData;a.append("form-id",t.dataset.formId),a.append("column-name",o.id),await FormSubmit.fetchRestApi("forms/save_table_prefs",a)}else e.classList.contains("visible")?(e.classList.replace("visible","invisible"),e.src=e.src.replace("visible.png","invisible.png"),e.closest("td").querySelector("input").value=0):(e.classList.replace("invisible","visible"),e.src=e.src.replace("invisible.png","visible.png"),e.closest("td").querySelector("input").value=1)})(s);else{if(!s.matches(".reset-col-vis"))return;!async function(e){let t=new FormData;t.append("form-id",e.dataset.formId);let a=await FormSubmit.fetchRestApi("forms/delete_table_prefs",t);a&&(Main.displayMessage(a),location.reload())}(s)}o.stopImmediatePropagation()})),document.addEventListener("DOMContentLoaded",(function(){if("undefined"!=typeof Sortable){let e={handle:".movecontrol",animation:150};document.querySelectorAll(".sortable-column-settings-rows tbody").forEach((t=>{Sortable.create(t,e)}))}document.querySelectorAll(".form-data-table th").forEach((e=>{e.style.minWidth=parseFloat(window.getComputedStyle(e).width)+20+"px"}))})),document.addEventListener("change",(e=>{let t=e.target;"sim-forms-selector"==t.id&&(document.querySelectorAll(".main-form-wrapper").forEach((e=>{e.classList.add("hidden")})),document.getElementById(t.value).classList.remove("hidden"),SimTableFunctions.positionTable(),e.stopImmediatePropagation())})),document.addEventListener("table-content-update-inputs-loaded",(async e=>{let t=e.target;t.matches(".forms-table:not(.active, .copy)")&&await async function(e){let t=e.closest("table").dataset.formId,a=e.closest("tr").dataset.id,s=e.dataset,r=Main.showLoader(e.querySelector(".override-wrapper"),!0),i=new FormData;for(var n in i.append("form-id",t),i.append("submission-id",a),i.append("element-id",s.elementId),s)i.append(n,s[n]);let l=await FormSubmit.fetchRestApi("forms/get_input_html",i);l?(r.outerHTML=`<div class='input-wrapper'>${l}</div>`,e.querySelectorAll(".file-upload-wrap").forEach((e=>e.addEventListener("uploadfinished",o))),e.querySelectorAll("input").forEach((e=>e.showPicker()))):(e.innerHTML=e.dataset.oldHtml,e.classList.remove("active"))}(t)})),document.addEventListener("table-content-before-update",(e=>{s(e.target)}))})();
//# sourceMappingURL=forms_table.min.js.map