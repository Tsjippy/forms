(()=>{async function e(e){let t={title:"Are you sure?",text:`Are you sure you want to ${e} this?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:`Yes, ${e} it!`};null!=document.fullscreenElement&&(t.target=document.fullscreenElement);let a=await Swal.fire(t);return document.fullscreenElement,a.isConfirmed}function t(e,t){let a;"archive"==t?(t="unarchive",a="Unarchive"):(t="archive",a="Archive"),e.outerHTML=`<button class="${t} button forms-table-action" name="${t}-action" value="${t}">${a}</button>`}function a(e,t){e.querySelector(".current").classList.remove("current"),e.querySelector(`[data-nr="${t}"]`).classList.add("current"),0==t?e.querySelector(".prev").classList.add("hidden"):e.querySelector(".prev").classList.remove("hidden"),t==e.querySelectorAll(".page-number").length-1?e.querySelector(".next").classList.add("hidden"):e.querySelector(".next").classList.remove("hidden")}function s(e){e.querySelectorAll(".file-upload-wrap").forEach((e=>e.addEventListener("uploadfinished",o))),e.querySelectorAll("select").forEach((e=>{null==e._niceSelect&&Main.attachNiceSelect(e)})),e.querySelector("input, select, textarea").focus(),e.querySelector("button.save").classList.remove("hidden")}function o(e){null!=e.target.closest("td")&&(document.removeEventListener("uploadfinished",o),r(document.querySelector("[data-oldText]")))}async function r(e){if(null!=e.closest(".schedule"))return;let t=e.closest("table"),a=e.closest("td"),s=a.dataset,o=e.closest("tr").dataset.submissionId,r=FormFunctions.getFieldValue(e,a,!1),i="";if(null!=e.closest("[data-shortcode-id]")&&(i=e.closest("[data-shortcode-id]").dataset.shortcodeId),r!=s.oldText){a.querySelector("button.save").classList.add("hidden"),Main.showLoader(a.querySelector(".input-wrapper"),!0,50,"Saving...");let n=new FormData;n.append("submission-id",o),n.append("element-id",s.elementId),n.append("new-value",JSON.stringify(r)),null!=s.subid&&n.append("subid",s.subid),""!=i&&n.append("shortcode-id",i);let l=await FormSubmit.fetchRestApi("forms/edit_value",n);if(l){e.classList.remove("editing");let r=l["new-value"];return"string"==typeof r&&r.replace("_"," "),""==r&&(r="X"),null!=s.subid?t.querySelectorAll(`tr[data-submission-id="${o}"] td[data-element-id="${s.id}"]`).forEach((e=>{e.innerHTML=r})):a.innerHTML=r,void Main.displayMessage(l.message.replace("_"," "))}}a.innerHTML=a.dataset.oldHtml}console.log("Formstable.js loaded"),document.addEventListener("click",(s=>{let o=s.target;if("submit_column_setting"==o.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_column_settings");t&&(Main.displayMessage(t),location.reload())}(o);else if("submit_table_setting"==o.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_table_settings");t&&Main.displayMessage(t)}(o);else if("form-settings[autoarchive]"==o.name){let e=o.closest(".table-rights-wrapper").querySelector(".auto-archive-logic");"1"==o.value?e.classList.remove("hidden"):e.classList.add("hidden")}else if(null!=o.closest(".form-result-navigation")&&(o.matches(".next")||o.matches(".prev")||o.matches(".page-number")))!async function(e){let t=e.closest(".form.table-wrapper"),s=e.closest(".form-result-navigation"),o=e.closest(".form-results-wrapper"),r=o.querySelector(".form-data-table:not(.hidden)");r.classList.add("hidden");let i,n=parseInt(s.querySelector(".page-number-wrapper .current").dataset.nr);i=e.matches(".next")?n+1:e.matches(".prev")?n-1:e.dataset.nr,a(s,i);let l=o.querySelector(`[data-page="${i}"]`);if(null!=l)return console.log(l),void l.classList.remove("hidden");let d,c=r.dataset.formId,u=Main.showLoader(r,!1);d=null==t.querySelector(".filter-options")?new FormData:new FormData(t.querySelector(".filter-options")),d.append("form-id",c),d.append("page-number",i),d.append("shortcode-id",r.dataset.shortcodeId),d.append("type",r.dataset.type);let m,p,f=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});m=null!=f.archived,p=null!=f.onlyOwn,d.append("archived",m),d.append("only-own",p),o.dataset.sortcol&&d.append("sortcol",o.dataset.sortcol),o.dataset.sortdir&&d.append("sortdir",o.dataset.sortdir);let h=await FormSubmit.fetchRestApi("forms/get_page",d);h?u.outerHTML=h:(r.classList.remove("hidden"),u.remove(),a(s,n))}(o);else if("TH"==o.tagName&&null!=o.closest(".form-results-wrapper").querySelector(".form-result-navigation"))!async function(e){let t=e.closest(".form.table-wrapper"),s=e.closest(".form-results-wrapper");a(s.querySelector(".form-result-navigation"),0);let o=s.querySelector(".form-data-table:not(.hidden)"),r=o.dataset.formId,i=e.id,n=e.classList.contains("desc")?"DESC":"ASC";s.dataset.sortcol=i,s.dataset.sortdir=n;let l,d=Main.showLoader(o,!0,50,"Loading sorted data");l=null==t.querySelector(".filter-options")?new FormData:new FormData(t.querySelector(".filter-options")),l.append("form-id",r),l.append("page-number",0),l.append("shortcode-id",o.dataset.shortcodeId),l.append("type",o.dataset.type);let c,u,m=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});c=null!=m.archived,u=null!=m.onlyOwn,l.append("archived",c),l.append("only-own",u),l.append("sortcol",i),l.append("sortdir",n);let p=await FormSubmit.fetchRestApi("forms/get_page",l);p?d.outerHTML=p:(o.classList.remove("hidden"),d.remove())}(o);else if(o.matches(".copy"))(async e=>{let t=e.closest("td").innerText;try{let e={icon:"success",title:`Copied '${t}'`,showConfirmButton:!1,timer:3e3};Swal.fire(e),navigator.clipboard.writeText(t)}catch(e){Main.displayMessage("Failed to copy: "+e,"error")}})(o);else if(o.matches(".delete.forms-table-action"))!async function(t){if(await e("delete")){let e=t.closest("tr").dataset.submissionId,a=t.closest("table"),s=new FormData;s.append("form-id",a.dataset.formId),s.append("submission-id",e),Main.showLoader(t),await FormSubmit.fetchRestApi("forms/remove_submission",s)&&a.querySelectorAll(`.table-row[data-submission-id="${e}"]`).forEach((e=>e.remove()))}}(o);else if(o.matches(".archive.forms-table-action, .unarchive.forms-table-action"))!async function(a){let s,o=a.closest("table"),r=a.closest("tr"),i=r.dataset.submissionId,n=!0,l=a.value,d=new FormData;if(d.append("form-id",o.dataset.formId),d.append("submission-id",i),d.append("action",l),null!=r.dataset.subid){n=!1;let e={title:`What do you want to ${l}?`,text:`Do you want to ${l} just this one or the whole request?`,icon:"question",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Just this one",denyButtonText:"The whole request",confirmButtonColor:"#bd2919"};if(null!=document.fullscreenElement&&(e.target=document.fullscreenElement),s=await Swal.fire(e),s.isConfirmed&&d.append("subid",r.dataset.subid),s.isDismissed)return}if((!n||await e(l))&&(Main.showLoader(a),s=await FormSubmit.fetchRestApi("forms/archive_submission",d),s)){let e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});const a=new Event("submissionArchived");null==d.get("subid")?o.querySelectorAll(`[data-submission-id="${i}"]`).forEach((s=>{if(s.dispatchEvent(a),e.archived){let e;e="archive"==l?s.querySelector(".loader-wrapper, .archive"):s.querySelector(".loader-wrapper, .unarchive"),t(e,l)}else s.remove()})):o.querySelectorAll(`.table-row[data-submission-id="${i}"][data-subid="${r.dataset.subid}"]`).forEach((s=>{s.dispatchEvent(a),e.archived?t(s.querySelector(".loader-wrapper"),l):s.remove()}))}}(o);else if(o.matches(".print.forms-table-action"))window.location.href=window.location.href.split("?")[0]+"?print=true&table_id="+table.dataset.id+"&submission_id="+table_row.querySelector("[id='id' i]").textContent;else if(o.classList.contains("edit-formshortcode-settings"))Main.showModal(document.querySelector(".modal.form-shortcode-settings"));else if(o.matches("form .table-permissions-rights-form"))o.closest("div").querySelector(".permission-wrapper").classList.toggle("hidden");else if(o.classList.contains("visibility-icon"))(async e=>{if("SPAN"==e.tagName&&(e=e.querySelector("img")),e.parentNode.matches("th")){let s=e.parentNode;var t=s.closest("table"),a=new FormData;a.append("form-id",t.dataset.formId),a.append("column-name",s.id),await FormSubmit.fetchRestApi("forms/save_table_prefs",a)}else e.classList.contains("visible")?(e.classList.replace("visible","invisible"),e.src=e.src.replace("visible.png","invisible.png"),e.closest("td").querySelector("input").value=0):(e.classList.replace("invisible","visible"),e.src=e.src.replace("invisible.png","visible.png"),e.closest("td").querySelector("input").value=1)})(o);else{if(!o.matches(".reset-col-vis"))return;!async function(e){let t=new FormData;t.append("form-id",e.dataset.formId);let a=await FormSubmit.fetchRestApi("forms/delete_table_prefs",t);a&&(Main.displayMessage(a),location.reload())}(o)}s.stopImmediatePropagation()})),document.addEventListener("DOMContentLoaded",(function(){if("undefined"!=typeof Sortable){let e={handle:".movecontrol",animation:150};document.querySelectorAll(".sortable-column-settings-rows tbody").forEach((t=>{Sortable.create(t,e)}))}document.querySelectorAll(".form-data-table th").forEach((e=>{e.style.minWidth=parseFloat(window.getComputedStyle(e).width)+20+"px"}))})),document.addEventListener("change",(e=>{let t=e.target;"sim-forms-selector"==t.id&&(document.querySelectorAll(".main-form-wrapper").forEach((e=>{e.classList.add("hidden")})),document.getElementById(t.value).classList.remove("hidden"),SimTableFunctions.positionTable(),e.stopImmediatePropagation())})),document.addEventListener("table-content-update-inputs-loaded",(async e=>{let t=e.target;t.matches(".forms-table:not(.copy)")&&(e.preventDefault(),await async function(e){let t=e.dataset,a=e.closest("tr").dataset.submissionId,o=e.closest("table").dataset.shortcodeId,r=Main.showLoader(e.querySelector(".override-wrapper"),!0,50,"Loading..."),i=new FormData;null!=t.subid&&i.append("subid",t.subid),i.append("submission-id",a),i.append("shortcode-id",o),i.append("element-id",t.elementId);let n=await FormSubmit.fetchRestApi("forms/get_input_html",i);n?(r.outerHTML=`<div class='input-wrapper'>${n}</div>`,s(e)):(e.innerHTML=e.dataset.oldHtml,e.classList.remove("editing"))}(t),button.classList.remove("hidden"),s(t))})),document.addEventListener("table-content-before-update",(async e=>{let t=e.target;t.matches(".forms-table:not(.copy)")&&(e.preventDefault(),r(t))}))})();
//# sourceMappingURL=forms_table.min.js.map