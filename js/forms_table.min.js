(()=>{async function e(e){let t={title:"Are you sure?",text:`Are you sure you want to ${e} this?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:`Yes, ${e} it!`};null!=document.fullscreenElement&&(t.target=document.fullscreenElement);let a=await Swal.fire(t);return document.fullscreenElement,a.isConfirmed}function t(e,t){let a;"archive"==t?(t="unarchive",a="Unarchive"):(t="archive",a="Archive"),e.outerHTML=`<button class="${t} button forms-table-action" name="${t}_action" value="${t}">${a}</button>`}async function a(e){let t=e.closest("table");document.querySelectorAll("td.active").forEach((t=>{t!=e&&i(t)})),e.classList.add("active");let a=t.dataset.formid,o=e.closest("tr").dataset.id,n=e.dataset,l=e.textContent;Main.showLoader(e.firstChild),e.dataset.oldtext=l;let d=new FormData;for(var c in d.append("formid",a),d.append("submissionid",o),n)d.append(c,n[c]);let u=await FormSubmit.fetchRestApi("forms/get_input_html",d);u?(e.innerHTML=`<div class='input-wrapper'>${u}</div>`,s(e),e.querySelectorAll(".file-upload-wrap").forEach((e=>e.addEventListener("uploadfinished",r))),e.querySelectorAll("input").forEach((e=>e.showPicker()))):(e.innerHTML=e.dataset.oldtext,e.classList.remove("active"))}function o(e,t){e.querySelector(".current").classList.remove("current"),e.querySelector(`[data-nr="${t}"]`).classList.add("current"),0==t?e.querySelector(".prev").classList.add("hidden"):e.querySelector(".prev").classList.remove("hidden"),t==e.querySelectorAll(".pagenumber").length-1?e.querySelector(".next").classList.add("hidden"):e.querySelector(".next").classList.remove("hidden")}function s(e){let t=e.querySelectorAll("input,select,textarea");t.forEach((e=>{"select-one"==e.type&&Main.attachNiceSelect(select),("radio"!=e.type&&"checkbox"!=e.type||1==t.length)&&("date"==e.type&&e.addEventListener("blur",i),e.focus())}))}function r(e){null!=e.target.closest("td")&&(document.removeEventListener("uploadfinished",r),i(document.querySelector("[data-oldtext]")))}console.log("Formstable.js loaded");var n=!1;async function i(e){if(null!=e.target&&(e=e.target),n==e||""==e.value||e.matches(".nice-select-search"))return;n=e,setTimeout((function(){n=!1}),500);let t=e.closest("table"),a=t.dataset.formid,o=e.closest("tr").dataset.id,r=e.closest("td");r.classList.remove("active");let i=r.dataset,l=FormFunctions.getFieldValue(e,r,!1),c="";if(null!=e.closest("[data-shortcodeid]")&&(c=e.closest("[data-shortcodeid]").dataset.shortcodeid),l!=JSON.parse(r.dataset.oldvalue)){Main.showLoader(r.querySelector(".input-wrapper"));let e=new FormData;for(d in e.append("formid",a),e.append("submissionid",o),i)e.append(d,i[d]);e.append("newvalue",JSON.stringify(l)),""!=c&&e.append("shortcode_id",c);let s=await FormSubmit.fetchRestApi("forms/edit_value",e);if(s){console.log(s);let e=s.newvalue;"string"==typeof e&&e.replace("_"," "),""==e&&(e="X"),null==i.subid?t.querySelectorAll(`tr[data-id="${o}"] td[data-id="${i.id}"]`).forEach((t=>{t.innerHTML=e})):r.innerHTML=e,r.dataset.oldvalue=JSON.stringify(e),Main.displayMessage(s.message.replace("_"," "))}else r.innerHTML=r.dataset.oldtext}else r.innerHTML=r.dataset.oldtext;s(e),null!=e.dataset.oldtext&&delete e.dataset.oldtext}function l(e){let t=e.closest("td.active");if(null==t)return;let a=document.createElement("button");a.innerHTML="Save changes",a.classList.add("button"),a.classList.add("small"),a.classList.add("save"),a.addEventListener("click",(e=>i(e.target.closest("td").querySelector("input")))),null==t.querySelector(".save")&&t.querySelector(".input-wrapper").appendChild(a)}document.addEventListener("click",(s=>{let r=s.target;if("submit_column_setting"==r.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_column_settings");t&&(Main.displayMessage(t),location.reload())}(r),s.stopPropagation();else if("submit_table_setting"==r.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_table_settings");t&&Main.displayMessage(t)}(r);else if("form_settings[autoarchive]"==r.name){let e=r.closest(".table-rights-wrapper").querySelector(".autoarchivelogic");"1"==r.value?e.classList.remove("hidden"):e.classList.add("hidden")}else null!=r.closest(".form-result-navigation")&&(r.matches(".next")||r.matches(".prev")||r.matches(".pagenumber"))&&(async function(e){let t=e.closest(".form.table-wrapper"),a=e.closest(".form-result-navigation"),s=e.closest(".form-results-wrapper"),r=s.querySelector(".form-data-table:not(.hidden)");r.classList.add("hidden");let n,i=parseInt(a.querySelector(".page-number-wrapper .current").dataset.nr);n=e.matches(".next")?i+1:e.matches(".prev")?i-1:e.dataset.nr,o(a,n);let l=s.querySelector(`[data-page="${n}"]`);if(null!=l)return console.log(l),void l.classList.remove("hidden");let d,c=r.dataset.formid,u=Main.showLoader(r,!1);d=null==t.querySelector(".filteroptions")?new FormData:new FormData(t.querySelector(".filteroptions")),d.append("formid",c),d.append("pagenumber",n),d.append("shortcode_id",r.dataset.shortcodeid),d.append("type",r.dataset.type);let m,p,f=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});m=null!=f.archived,p=null!=f.onlyown,d.append("archived",m),d.append("onlyown",p),s.dataset.sortcol&&d.append("sortcol",s.dataset.sortcol),s.dataset.sortdir&&d.append("sortdir",s.dataset.sortdir);let h=await FormSubmit.fetchRestApi("forms/get_page",d);h?u.outerHTML=h:(r.classList.remove("hidden"),u.remove(),o(a,i))}(r),s.stopPropagation());"TH"==r.tagName&&null!=r.closest(".form-results-wrapper").querySelector(".form-result-navigation")&&async function(e){let t=e.closest(".form.table-wrapper"),a=e.closest(".form-results-wrapper");o(a.querySelector(".form-result-navigation"),0);let s=a.querySelector(".form-data-table:not(.hidden)"),r=s.dataset.formid,n=e.id,i=e.classList.contains("desc")?"DESC":"ASC";a.dataset.sortcol=n,a.dataset.sortdir=i;let l,d=Main.showLoader(s,!0,50,"Loading sorted data");l=null==t.querySelector(".filteroptions")?new FormData:new FormData(t.querySelector(".filteroptions")),l.append("formid",r),l.append("pagenumber",0),l.append("shortcode_id",s.dataset.shortcodeid),l.append("type",s.dataset.type);let c,u,m=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});c=null!=m.archived,u=null!=m.onlyown,l.append("archived",c),l.append("onlyown",u),l.append("sortcol",n),l.append("sortdir",i);let p=await FormSubmit.fetchRestApi("forms/get_page",l);p?d.outerHTML=p:(s.classList.remove("hidden"),d.remove())}(r),r.matches(".copy")&&(async e=>{let t=e.closest("td").innerText;try{let e={icon:"success",title:`Copied '${t}'`,showConfirmButton:!1,timer:3e3};Swal.fire(e),navigator.clipboard.writeText(t)}catch(e){Main.displayMessage("Failed to copy: "+e,"error")}})(r),r.matches(".delete.forms-table-action")&&async function(t){if(await e("delete")){let e=t.closest("tr").dataset.id,a=t.closest("table"),o=new FormData;o.append("formid",a.dataset.formid),o.append("submissionid",e),Main.showLoader(t),await FormSubmit.fetchRestApi("forms/remove_submission",o)&&a.querySelectorAll(`.table-row[data-id="${e}"]`).forEach((e=>e.remove()))}}(r),r.matches(".archive.forms-table-action, .unarchive.forms-table-action")&&async function(a){let o,s=a.closest("table"),r=a.closest("tr"),n=r.dataset.id,i=!0,l=a.value,d=new FormData;if(d.append("formid",s.dataset.formid),d.append("submissionid",n),d.append("action",l),null!=r.dataset.subid){i=!1;let e={title:`What do you want to ${l}?`,text:`Do you want to ${l} just this one or the whole request?`,icon:"question",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Just this one",denyButtonText:"The whole request",confirmButtonColor:"#bd2919"};if(null!=document.fullscreenElement&&(e.target=document.fullscreenElement),o=await Swal.fire(e),o.isConfirmed&&d.append("subid",r.dataset.subid),o.isDismissed)return}if((!i||await e(l))&&(Main.showLoader(a),o=await FormSubmit.fetchRestApi("forms/archive_submission",d),o)){let e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});const a=new Event("submissionArchived");null==d.get("subid")?s.querySelectorAll(`[data-id="${n}"]`).forEach((o=>{if(o.dispatchEvent(a),"true"==e.archived){let e;e="archive"==l?o.querySelector(".loader-wrapper, .archive"):o.querySelector(".loader-wrapper, .unarchive"),t(e,l)}else o.remove()})):s.querySelectorAll(`.table-row[data-id="${n}"][data-subid="${r.dataset.subid}"]`).forEach((o=>{o.dispatchEvent(a),"true"==e.archived?t(o.querySelector(".loader-wrapper"),l):o.remove()}))}}(r),r.matches(".print.forms-table-action")&&(window.location.href=window.location.href.split("?")[0]+"?print=true&table_id="+table.dataset.id+"&submission_id="+table_row.querySelector("[id='id' i]").textContent),r.classList.contains("edit-formshortcode-settings")&&Main.showModal(document.querySelector(".modal.form_shortcode_settings"));let n=r.closest("td");r.matches(".copy")||!n||n.matches(".active")||(async(e,t)=>{let o=e.target;o.matches("td.edit-forms-table")?(e.stopPropagation(),a(o)):!t.matches("td.edit-forms-table")||"INPUT"==o.tagName||"A"==o.tagName||"TEXTAREA"==o.tagName||o.closest(".nice-select")||o.matches(".button.save")||(console.log(o),e.stopPropagation(),a(o.closest("td")))})(s,n);let l=document.querySelector("td.active");null!=l&&null==n&&null==l.closest(".schedule")&&("checkbox"==r.type&&1!=r.length||(console.log(r),i(l))),r.matches("form .table-permissions-rights-form")&&r.closest("div").querySelector(".permission-wrapper").classList.toggle("hidden"),r.classList.contains("visibility-icon")&&(async e=>{if("SPAN"==e.tagName&&(e=e.querySelector("img")),e.parentNode.matches("th")){let o=e.parentNode;var t=o.closest("table"),a=new FormData;a.append("formid",t.dataset.formid),a.append("column_name",o.id),await FormSubmit.fetchRestApi("forms/save_table_prefs",a)}else e.classList.contains("visible")?(e.classList.replace("visible","invisible"),e.src=e.src.replace("visible.png","invisible.png"),e.closest(".column-setting-wrapper").querySelector(".visibilitytype").value="hide"):(e.classList.replace("invisible","visible"),e.src=e.src.replace("invisible.png","visible.png"),e.closest(".column-setting-wrapper").querySelector(".visibilitytype").value="show")})(r),r.matches(".reset-col-vis")&&async function(e){let t=new FormData;t.append("formid",e.dataset.formid);let a=await FormSubmit.fetchRestApi("forms/delete_table_prefs",t);a&&(Main.displayMessage(a),location.reload())}(r)})),document.addEventListener("DOMContentLoaded",(function(){if("undefined"!=typeof Sortable){let e={handle:".movecontrol",animation:150};document.querySelectorAll(".sortable-column-settings-rows tbody").forEach((t=>{Sortable.create(t,e)}))}document.querySelectorAll(".form-data-table th").forEach((e=>{e.style.minWidth=parseFloat(window.getComputedStyle(e).width)+20+"px"}))})),document.addEventListener("change",(e=>{let t=e.target;"sim-forms-selector"==t.id&&(document.querySelectorAll(".main_form_wrapper").forEach((e=>{e.classList.add("hidden")})),document.getElementById(t.value).classList.remove("hidden"),SimTableFunctions.positionTable()),null!=t.closest("td.active")&&("file"!=t.type&&"date"!=t.type&&"checkbox"!=t.type?(names=[],t.closest("td.active").querySelectorAll("input").forEach((e=>{names.includes(e.type)||names.push(e.type)})),1==names.length?i(t):l(t)):"file"!=t.type&&l(t))})),document.addEventListener("keyup",(function(e){if(["Enter","NumpadEnter"].includes(e.key)&&null==c.Shift){let e=document.querySelector("td.active");null!=e&&i(e)}delete c[e.key]}));let c={};document.addEventListener("keydown",(e=>{c[e.key]=!0}))})();
//# sourceMappingURL=forms_table.min.js.map