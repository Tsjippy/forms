(()=>{async function e(e){let t={title:"Are you sure?",text:`Are you sure you want to ${e} this?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#bd2919",cancelButtonColor:"#d33",confirmButtonText:`Yes, ${e} it!`};null!=document.fullscreenElement&&(t.target=document.fullscreenElement);let a=await Swal.fire(t);return document.fullscreenElement,a.isConfirmed}function t(e,t){let a;"archive"==t?(t="unarchive",a="Unarchive"):(t="archive",a="Archive"),e.outerHTML=`<button class="${t} button forms-table-action" name="${t}-action" value="${t}">${a}</button>`}async function a(e,t){let a,s=e.closest(".form.table-wrapper"),r=s.innerHTML;a="filter"==t?s.querySelector(".form-results-wrapper"):e.closest(".form-results-wrapper");let o,n=a.querySelector(".form-data-table:not(.hidden)"),i=n.dataset.formId,l=n.dataset.shortcodeId,d=n.dataset.type,c=a.querySelector("select.page-size").value;if("page"==t){let t=e.closest(".form-result-navigation"),s=parseInt(t.querySelector(".page-number-wrapper .current").dataset.nr);var u;!function(e,t){e.querySelector(".current").classList.remove("current"),e.querySelector(`[data-nr="${t}"]`).classList.add("current"),0==t?e.querySelector(".prev").classList.add("hidden"):e.querySelector(".prev").classList.remove("hidden"),t==e.querySelectorAll(".page-number").length-1?e.querySelector(".next").classList.add("hidden"):e.querySelector(".next").classList.remove("hidden")}(t,u=e.matches(".next")?s+1:e.matches(".prev")?s-1:e.dataset.nr);let r=a.querySelector(`[data-page="${u}"]`);if(null!=r)return void r.classList.remove("hidden");n.classList.add("hidden"),Main.showLoader(n,!1,100,"Loading data")}else"sort"==t||"size"==t?(a.classList.add(n.dataset.type),a.innerHTML=Main.showLoader("",!0,100,"Loading data",!0)):(d="all",s.querySelectorAll(".form-results-wrapper").forEach((e=>{e.classList.add(e.querySelector("table").dataset.type),e.innerHTML=Main.showLoader(e,!0,100,"Loading data",!0)})));o=null==s.querySelector(".filter-options")?new FormData:new FormData(s.querySelector("form.filter-options")),o.append("form-id",i),o.append("page-number",u),o.append("shortcode-id",l),o.append("type",d),o.append("pagesize",c);let m,p,f=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});m=null==f.archived?0:1,p=null==f.onlyOwn?0:1,o.append("archived",m),o.append("only-own",p),a.dataset.sortcol&&o.append("sortcol",a.dataset.sortcol),a.dataset.sortdir&&o.append("sortdir",a.dataset.sortdir);let h=await FormSubmit.fetchRestApi("forms/get_page",o);if(h){for(let[e,r]of Object.entries(h))"page"==t?(r=(new DOMParser).parseFromString(r,"text/html").querySelector("table.form-data-table").outerHTML,a.querySelector(".loader-wrapper").outerHTML=r):s.querySelector(`.form-results-wrapper.${e}`).outerHTML=r;document.querySelectorAll("select:not(.nonice,.swal2-select)").forEach((e=>Main.attachNiceSelect(e)))}else s.innerHTML=r}function s(e){e.querySelectorAll(".file-upload-wrap").forEach((e=>e.addEventListener("uploadfinished",r))),e.querySelectorAll("select").forEach((e=>{null==e._niceSelect&&Main.attachNiceSelect(e)})),e.querySelector("input, select, textarea").focus(),e.querySelector("button.save").classList.remove("hidden")}function r(e){null!=e.target.closest("td")&&(document.removeEventListener("uploadfinished",r),o(document.querySelector("[data-oldText]")))}async function o(e){if(null!=e.closest(".schedule"))return;let t=e.closest("table"),a=e.closest("td"),s=a.dataset,r=e.closest("tr").dataset.submissionId,o=FormFunctions.getFieldValue(e,a,!1),n="";if(null!=e.closest("[data-shortcode-id]")&&(n=e.closest("[data-shortcode-id]").dataset.shortcodeId),o!=s.oldText){a.querySelector("button.save").classList.add("hidden"),Main.showLoader(a.querySelector(".input-wrapper"),!0,50,"Saving...");let i=new FormData;i.append("submission-id",r),i.append("element-id",s.elementId),i.append("new-value",JSON.stringify(o)),null!=s.subid&&i.append("subid",s.subid),""!=n&&i.append("shortcode-id",n);let l=await FormSubmit.fetchRestApi("forms/edit_value",i);if(l){e.classList.remove("editing");let o=l["new-value"];return"string"==typeof o&&o.replace("_"," "),""==o&&(o="X"),null!=s.subid?t.querySelectorAll(`tr[data-submission-id="${r}"] td[data-element-id="${s.elementId}"]`).forEach((e=>{e.innerHTML=o})):a.innerHTML=o,void Main.displayMessage(l.message.replace("_"," "))}}a.innerHTML=a.dataset.oldHtml}console.log("Formstable.js loaded"),document.addEventListener("click",(s=>{let r=s.target;if("submit_column_setting"==r.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_column_settings");t&&(Main.displayMessage(t),location.reload())}(r);else if("submit_table_setting"==r.name)!async function(e){let t=await FormSubmit.submitForm(e,"forms/save_table_settings");t&&Main.displayMessage(t)}(r);else if("form-settings[autoarchive]"==r.name){let e=r.closest(".table-rights-wrapper").querySelector(".auto-archive-logic");"1"==r.value?e.classList.remove("hidden"):e.classList.add("hidden")}else if(null!=r.closest(".form-result-navigation")&&(r.matches(".next")||r.matches(".prev")||r.matches(".page-number")))a(r,"page");else if(r.matches(".button.filter-results"))a(r,"filter");else if(r.matches(".copy"))(async e=>{let t=e.closest("td").innerText;try{let e={icon:"success",title:`Copied '${t}'`,showConfirmButton:!1,timer:3e3};Swal.fire(e),navigator.clipboard.writeText(t)}catch(e){Main.displayMessage("Failed to copy: "+e,"error")}})(r);else if(r.matches(".delete.forms-table-action"))!async function(t){if(await e("delete")){let e=t.closest("tr").dataset.submissionId,a=t.closest("table"),s=new FormData;s.append("form-id",a.dataset.formId),s.append("submission-id",e),Main.showLoader(t),await FormSubmit.fetchRestApi("forms/remove_submission",s)&&a.querySelectorAll(`.table-row[data-submission-id="${e}"]`).forEach((e=>e.remove()))}}(r);else if(r.matches(".archive.forms-table-action, .unarchive.forms-table-action"))!async function(a){let s,r=a.closest("table"),o=a.closest("tr"),n=o.dataset.submissionId,i=!0,l=a.value,d=new FormData;if(d.append("form-id",r.dataset.formId),d.append("submission-id",n),d.append("action",l),null!=o.dataset.subid){i=!1;let e={title:`What do you want to ${l}?`,text:`Do you want to ${l} just this one or the whole request?`,icon:"question",showDenyButton:!0,showCancelButton:!0,confirmButtonText:"Just this one",denyButtonText:"The whole request",confirmButtonColor:"#bd2919"};if(null!=document.fullscreenElement&&(e.target=document.fullscreenElement),s=await Swal.fire(e),s.isConfirmed&&d.append("subid",o.dataset.subid),s.isDismissed)return}if((!i||await e(l))&&(Main.showLoader(a),s=await FormSubmit.fetchRestApi("forms/archive_submission",d),s)){let e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});const a=new Event("submissionArchived");null==d.get("subid")?r.querySelectorAll(`[data-submission-id="${n}"]`).forEach((s=>{if(s.dispatchEvent(a),e.archived){let e;e="archive"==l?s.querySelector(".loader-wrapper, .archive"):s.querySelector(".loader-wrapper, .unarchive"),t(e,l)}else s.remove()})):r.querySelectorAll(`.table-row[data-submission-id="${n}"][data-subid="${o.dataset.subid}"]`).forEach((s=>{s.dispatchEvent(a),e.archived?t(s.querySelector(".loader-wrapper"),l):s.remove()}))}}(r);else if(r.classList.contains("edit-formshortcode-settings"))Main.showModal(document.querySelector(".modal.form-shortcode-settings"));else if(r.matches("form .table-permissions-rights-form"))r.closest("div").querySelector(".permission-wrapper").classList.toggle("hidden");else{if(!r.matches(".reset-col-vis"))return;!async function(e){let t=new FormData;t.append("form-id",e.dataset.formId);let a=await FormSubmit.fetchRestApi("forms/delete_table_prefs",t);a&&(Main.displayMessage(a),location.reload())}(r)}s.stopImmediatePropagation()})),document.addEventListener("DOMContentLoaded",(function(){if("undefined"!=typeof Sortable){let e={handle:".movecontrol",animation:150};document.querySelectorAll(".sortable-column-settings-rows tbody").forEach((t=>{Sortable.create(t,e)}))}document.querySelectorAll(".form-data-table th").forEach((e=>{e.style.minWidth=parseFloat(window.getComputedStyle(e).width)+20+"px"}))})),document.addEventListener("change",(e=>{let t=e.target;if("sim-forms-selector"==t.id)document.querySelectorAll(".main-form-wrapper").forEach((e=>{e.classList.add("hidden")})),document.getElementById(t.value).classList.remove("hidden"),SimTableFunctions.positionTable();else{if(!t.matches(".page-size"))return;a(t,"size")}e.stopImmediatePropagation()})),document.addEventListener("table-content-update-inputs-loaded",(async e=>{let t=e.target;t.matches(".forms-table")&&(e.preventDefault(),await async function(e){let t=e.dataset,a=e.closest("tr").dataset.submissionId,r=e.closest("table").dataset.shortcodeId,o=Main.showLoader(e.querySelector(".override-wrapper"),!0,50,"Loading..."),n=new FormData;null!=t.subid&&n.append("subid",t.subid),n.append("submission-id",a),n.append("shortcode-id",r),n.append("element-id",t.elementId);let i=await FormSubmit.fetchRestApi("forms/get_input_html",n);i?(o.outerHTML=`<div class='input-wrapper'>${i}</div>`,s(e)):(e.innerHTML=e.dataset.oldHtml,e.classList.remove("editing"))}(t),s(t))})),document.addEventListener("table-content-before-update",(async e=>{let t=e.target;t.matches(".forms-table")&&(e.preventDefault(),o(t))})),document.addEventListener("table-content-before-column-hide",(async e=>{let t=e.target;null==t.closest(".column-setting-wrapper")&&null==t.closest(".form-data-table")||(e.preventDefault(),(async e=>{if(e.parentNode.matches("th")){let s=e.parentNode;var t=s.closest("table");let r=t.rows;for(const e of r)e.cells[s.cellIndex].classList.add("hidden");var a=new FormData;a.append("form-id",t.dataset.formId),a.append("column-name",s.id),await FormSubmit.fetchRestApi("forms/save_table_prefs",a)}else e.classList.contains("visible")?(e.classList.replace("visible","invisible"),e.src=e.src.replace("visible.png","invisible.png"),e.closest("td").querySelector("input").value=0):(e.classList.replace("invisible","visible"),e.src=e.src.replace("invisible.png","visible.png"),e.closest("td").querySelector("input").value=1)})(t))})),document.addEventListener("table-sorted",(async e=>{let t=e.target;if(null!=t.closest(".form-results-wrapper").querySelector(".form-result-navigation")){let e=t.id,s=t.classList.contains("desc")?"DESC":"ASC",r=t.closest(".form-results-wrapper");r.dataset.sortcol=e,r.dataset.sortdir=s,a(t,"sort")}}))})();
//# sourceMappingURL=forms_table.min.js.map