!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FormFunctions=t():e.FormFunctions=t()}(self,(()=>(()=>{"use strict";var e={d:(t,l)=>{for(var r in l)e.o(l,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:l[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};let l;e.r(t),e.d(t,{changeFieldProperty:()=>S,changeFieldValue:()=>y,changeVisibility:()=>v,cloneNode:()=>s,copyFormInput:()=>c,fixNumbering:()=>d,getFieldValue:()=>n,nextPrev:()=>h,removeDefaultSelect:()=>a,removeNode:()=>u,showFormStep:()=>p,tidyMultiInputs:()=>m,updateMultiStepControls:()=>f});let r=function(e){"undefined"!=typeof tinymce&&(tinymce.remove(),document.querySelectorAll(".entry-content .wp-editor-area").forEach((e=>{window.tinyMCE.execCommand("mceAddEditor",!1,e.id)}))),window.document.dispatchEvent(new Event("DOMContentLoaded",{bubbles:!0,cancelable:!0})),document.querySelectorAll(".wp-switch-editor").forEach((e=>e.addEventListener("click",(t=>{let l=e.closest(".wp-editor-wrap").querySelector(".wp-editor-area"),r=e.closest(".wp-editor-wrap").querySelector(".mce-panel");l.style.visibility="unset",t.target.matches(".switch-tmce")?(r.style.display="block",l.style.display="none"):(r.style.display="none",l.style.display="block")})))),document.querySelectorAll("select:not(.nonice,.swal2-select)").forEach((function(e){Main.attachNiceSelect(e)}));const t=new Event("scriptsloaded");e.dispatchEvent(t)},o=function(e){if(null==e)return;0==l.length&&r(e);let t=l.shift();if(null!=t)if("SCRIPT"==t.tagName&&null==document.getElementById(t.id)){var n=document.createElement("script");""==t.type?n.type="text/javascript":n.type=t.type,""!=t.src?n.src=t.src:n.innerHTML=t.innerHTML,n.id=t.id;try{document.head.appendChild(n)}catch(e){console.error(e)}l.length>0?""!=t.src?n.addEventListener("load",o.bind(null,e)):o(e):""!=t.src?n.addEventListener("load",r.bind(null,e)):r(e)}else l.length>0?o(e):r(e);else r(e)};function n(e,t,l=!0,r=null,o=!1){let n="",a="",i="",s="";return e instanceof Element?(n=e,"INPUT"!=n.tagName&&"TEXTAREA"!=n.tagName&&"SELECT"!=n.tagName&&null==n.closest(".nice-select-dropdown")&&(n=n.querySelector("input, select, textarea")),null==n&&(n=e),a=n.name):e.match("E[0-9]")?(s=`[id^=${e}]`,n=t.querySelector(s),a=n.name):(a=e,s=`[name='${a}' i]`,n=t.querySelector(s)),null==n?(console.trace(),console.log("cannot find element with name "+a),i):("radio"==n.type?i=function(e,t){let l=e.querySelector(`${t}:checked`);return null==l?"":l.value}(t,s):"checkbox"==n.type?i=function(e,t,l,r){let o="",n="";return"checkbox"==r.type&&null!=l?r.checked?r.value:"":(null!=l?(n=e.querySelector(`${t}[value="${l}" i]:checked`),null!=n&&(o=l)):(n=e.querySelectorAll(`${t}:checked`),o=[],n.forEach((e=>{o.push(e.value)}))),o)}(t,s,r,e):null!=n.closest(".nice-select-dropdown")&&null!=n.dataset.value?i=n.dataset.value:null!=n.list&&""!=n.value&&l?i=function(e){let t="",l=e.list.querySelector(`[value='${e.value}' i]`);return t=null==l?e.value:l.dataset.value,t}(n):null!=n.name&&n.name.endsWith("[]")?i=function(e,t){let l=[];return e.querySelectorAll(`[name="${t.name}"]`).forEach((e=>l.push(e.value))),l}(t,n):null!=n.value&&"undefined"!=n.value&&(i=n.value),o?i.toLowerCase():i)}function a(e){Array.from(e.options).forEach((function(e){e.defaultSelected=!1}))}let i=[];function s(e,t=!0){!function(e){"undefined"!=typeof tinymce&&e.querySelectorAll(".wp-editor-area").forEach((e=>{let t=tinymce.get(e.id);null!=t&&(i[e.id]=t.settings,t.save(),t.remove())}))}(e);let l=e.cloneNode(!0);return l.querySelectorAll(".nice-select").forEach((e=>e.remove())),e.querySelectorAll(".wp-editor-area").forEach((e=>{null!=i[e.id]&&tinymce.init(i[e.id])})),t&&l.querySelectorAll("input,select,textarea").forEach((e=>{"checkbox"==e.type||"radio"==e.type?e.checked=!1:e.matches(".no-reset")||(e.value=""),"select-one"==e.type&&a(e)})),l.querySelectorAll("select").forEach((e=>{a(e),Main.attachNiceSelect(e)})),l}function c(e){e.querySelectorAll(".remove.hidden").forEach((e=>e.classList.remove("hidden")));let t=s(e);t.querySelectorAll(".upload-files").forEach((function(e){e.dataset.index=nodeNr})),t.querySelectorAll(".document-preview").forEach((function(e){e.innerHTML=""}));let l=0;if(t.querySelectorAll("select").forEach((t=>{let r=e.getElementsByTagName("select")[l].selectedIndex;null!=t.options[r]&&(t.options[r].style.display="none"),Main.attachNiceSelect(t),l++})),e.matches(".tabcontent")){e.classList.add("hidden");let t=e.closest(".clone-divs-wrapper").querySelector(".tablink.active"),l=s(t);t.classList.remove("active"),t.parentNode.insertBefore(l,t.nextSibling)}if(e.parentNode.insertBefore(t,e.nextSibling),e.matches(".formstep")){t.classList.add("step-hidden");let l=e.closest("form");null!=l&&null!=l.querySelector(".multi-step-controls-wrapper")&&f(l);let r=e.querySelector(".add.button").textContent.replace("Add ","");Main.displayMessage(`Succesfully added an extra ${r}<br>Its added as the next page.`)}return t}function d(e){e.querySelectorAll(":scope > .clone-div, :scope > .tablink").forEach((function(e,t){""!=e.id&&(e.id=e.id.replace(/[0-9]+(?!.*[0-9])/,t)),"button"==e.type&&""!=e.textContent&&(e.textContent=e.textContent.replace(/[0-9]+(?!.*[0-9])/,t+1),e.dataset.target=e.dataset.target.replace(/[0-9]+(?!.*[0-9])/,t)),null!=e.dataset.divId&&(e.dataset.divId=t),e.querySelectorAll("h3, h4, legend :first-child").forEach((e=>{e.textContent=e.textContent.replace(/[0-9]+(?!.*[0-9])/,t+1)})),e.querySelectorAll("input,select,textarea").forEach((e=>{e.classList.contains("nice-select-search")||(""!=e.id&&null!=e.id&&(e.id=e.id.replace(/[0-9]+(?!.*[0-9])/,t)),""!=e.name&&null!=e.name&&(e.name=e.name.replace(/[0-9]+(?!.*[0-9])/,t)),"button"==e.type&&(e.value=e.value.replace(/[0-9]+(?!.*[0-9])/,t)))}))}))}function u(e){let t=e.closest(".clone-div"),l=t.closest(".clone-divs-wrapper"),r=l.querySelectorAll(".clone-div");if(r[r.length-1]==t){let e=t.querySelector(".add"),l=t.previousElementSibling;null==l.querySelector(".button-wrapper .add")&&l.querySelector(".button-wrapper").appendChild(e)}if(t.matches(".tabcontent")){let e=l.querySelector(`.tablink[data-target="${t.id}"]`);if(null!=e){if(e.classList.contains("active")){let t=e.previousElementSibling;if(null!=t)t.classList.add("active"),Main.displayTab(t);else{let t=e.nextElementSibling;null!=t&&(t.classList.add("active"),Main.displayTab(t))}}e.remove()}}if(t.matches(".formstep")){let e=null,r=l.querySelector(`.formstep[data-div-id='${parseInt(t.dataset.divId)+1}']`);if(null!=r)e=r;else{let r=l.querySelector(`.formstep[data-div-id='${parseInt(t.dataset.divId)-1}']`);null!=r&&(e=r)}if(null!=e){let l=t.closest("form");null!=l&&null!=l.querySelector(".multi-step-controls-wrapper")&&(f(l),l.querySelectorAll(".formstep").forEach(((t,r)=>{t==e&&p(r,l)})))}}t.remove(),1==l.querySelectorAll(".clone-div").length&&l.querySelector(".remove").classList.add("hidden"),d(l)}function m(){document.querySelectorAll(".clone-divs-wrapper").forEach((function(e){let t=e.querySelectorAll(":scope > .clone-div");1==t.length&&t[0].querySelectorAll(".remove").forEach((e=>e.remove())),t.forEach((function(e,t,l){e.dataset.divId=t,t!=l.length-1&&e.querySelectorAll(".add:not(:scope .clone-divs-wrapper .add)").forEach((e=>e.remove()))}))}))}function f(e){let t=e.querySelectorAll(".formstep"),l=e.querySelectorAll(".formstep:not(.hidden)"),r=e.querySelectorAll(".multi-step-controls-wrapper .step");r.forEach((e=>e.classList.remove("hidden")));for(let e=l.length;e<t.length;e++)r[e].classList.add("hidden");for(let l=r.length;l<t.length;l++){let t=document.createElement("span");t.classList.add("step"),e.querySelectorAll(".step-wrapper").forEach((e=>e.appendChild(t)))}let o=e.querySelector(".formstep:not(.step-hidden)");l[l.length-1]==o?(e.querySelector(".next-button").classList.add("hidden"),e.querySelector(".form-submit ").classList.remove("hidden")):(e.querySelector(".next-button").classList.remove("hidden"),e.querySelector(".form-submit ").classList.add("hidden"))}function p(e,t){if(void 0!==t){0==e&&(t.querySelectorAll(".loader-wrapper:not(.hidden), .loader-image-trigger").forEach((e=>e.remove())),t.querySelectorAll(".multi-step-controls.hidden").forEach((e=>e.classList.remove("hidden")))),t.querySelectorAll(".formstep:not(.step-hidden)").forEach((e=>e.classList.add("step-hidden")));let l=t.getElementsByClassName("formstep");if(0==l.length)return;let r=l[e].offsetTop-document.querySelector("#masthead").offsetHeight;window.scrollTo({top:r,behavior:"auto"}),l[e].classList.remove("step-hidden"),t.querySelectorAll(".step.active").forEach((e=>{e.classList.remove("active")})),l=t.getElementsByClassName("step");try{l[e].classList.add("active")}catch(t){console.log(l),console.log(e),console.error(t.message)}0==e?t.querySelector('[name="previous-button"]').classList.add("hidden"):t.querySelector('[name="previous-button"]').classList.remove("hidden"),e==l.length-1?(t.querySelector('[name="next-button"]').classList.add("hidden"),t.querySelector(".form-submit").classList.remove("hidden")):(t.querySelector('[name="next-button"]').classList.remove("hidden"),t.querySelector(".form-submit").classList.add("hidden"))}else console.log("no form defined")}function h(e,t){let l=t.querySelectorAll(".formstep"),r=t.querySelectorAll(".step"),o=0,n=!0;if(l.forEach(((e,t)=>{e.matches(".step-hidden")||(o=t)})),e>0){FormSubmit.prepareForValidation(l[o]);let e=l[o].querySelectorAll("input[required], textarea[required], select[required]");for(const t of e)if(t.required=!0,n=t.reportValidity(),!n)break;if(!n)return;r[o].classList.add("finish")}else r[o].classList.remove("finish");for(Array.from(l).forEach(((e,t)=>{e.classList.contains("hidden")&&r[t].classList.add("hidden")})),o+=e;l[o].classList.contains("hidden")&&(o+=e,!(o>=l.length)););return!(o>=l.length||(p(o,t),0))}function y(e,t,l,r,o="",a=!1){if(null==t)return;let i="",s="";if(e instanceof Element)s=e,i=s.name,e=""==s.id?`[name^="${s.name}" i]`:`[id^=${s.id}]`;else{s=r.querySelector(e);try{i=s.name}catch{console.log(s)}}if(n(s,r,!1,t)==t)return;if(null==s){let e=r.querySelectorAll(`.clone-div [name^="${i}" i]`);if(0===e.length)return;1==e.length?(s=e[0],e=""):(s=e[0],e.forEach(((e,t)=>{0==t?y(e,"","",r):u(e)})))}if(""!=o)if(/\d{4}-\d{2}-\d{2}/.test(t)){let e=new Date(t);e.setDate(e.getDate()+parseInt(o)),t=e.toISOString().split("T")[0]}else t+=parseInt(o);if("radio"==s.type||"checkbox"==s.type)if(""==t)""!=e&&r.querySelectorAll(e).forEach((e=>e.checked=!1));else if(s.value.toLowerCase()==t.toLowerCase())s.checked=!0;else{let e=r.querySelectorAll(`[name="${i}" i]`);for(const l of e)l.value.toLowerCase()==t.toLowerCase()&&(l.checked=!0)}else if("date"==s.type){if(s.value=t,!/\d{4}-\d{2}-\d{2}/.test(t)){let e="";if(3==t.split("-").length?e=t.split("-"):3==t.split("/").length&&(e=t.split("/")),""!=e){let t,l,r;e.forEach((e=>{4==e.length?t=e:2==e.length&&(e>12?r=e:null==l?l=e:r=e)})),null!=r&&null!=l&&null!=t&&(s.value=`${t}-${l}-${r}`)}}}else if(null!=s.list){let e=s.list.querySelector(`[data-value="${t}" i]`);if(null!=e)if(null!=s.closest(".clone-div")){let t;s.closest(".clone-divs-wrapper").querySelectorAll(".clone-div").forEach((e=>e.classList.add("shouldremove"))),e.value.split(";").forEach((e=>{t=c(s.closest(".clone-div")),t.classList.remove("shouldremove"),y(t.querySelector(s.tagName),e,"",r,"",!0)})),d(s.closest(".clone-divs-wrapper")),s.closest(".clone-divs-wrapper").querySelectorAll(".shouldremove").forEach((e=>e.remove()))}else s.value=e.value;else s.value=a?t:""}else s.value=t;let m=new Event("input");s.dispatchEvent(m),"function"==typeof l&&l(s)}function v(e,t,l){let r=t.closest(".input-wrapper");if(null==r&&(r=t),"add"==e){if(r.matches(".hidden"))return;r.classList.add("hidden")}else{if(!r.matches(".hidden"))return;r.classList.remove("hidden")}let o=new Event("input");r.dispatchEvent(o),"function"==typeof l&&l(t)}function S(e,t,l,r,o,n=""){let a=o.querySelector(e);if(""!=n)if(/\d{4}-\d{2}-\d{2}/.test(l)){let e=new Date(l);e.setDate(e.getDate()+parseInt(n)),l=e.toISOString().split("T")[0]}else l+=parseInt(n);a[t]=l;let i=new Event("input");a.dispatchEvent(i),r(a)}async function w(e){let t=e.closest(".form.table-wrapper"),l=e.outerHTML,r=new FormData,o=t.querySelector(".sim-table.form-data-table").dataset.formId,n=t.querySelector(".sim-table.form-data-table").dataset.shortcodeId;r.append("form-id",o),r.append("shortcode-id",n);const a=new URL(window.location);a.searchParams.get("only-own")&&r.append("only-own",!0),a.searchParams.get("all")&&r.append("all",!0),a.searchParams.get("archived")&&r.append("archived",!0);let i=Main.showLoader(e,!1,50,"Requesting form results...");t.innerHTML=i.outerHTML;let s=await FormSubmit.fetchRestApi("forms/show_form_results",r);s?t.innerHTML=s:i.outerHTML=l}return console.log("Forms.js is loaded"),document.addEventListener("DOMContentLoaded",(()=>{let e=Main.showLoader("",!1,100,"Please wait...",!0);document.querySelectorAll(".form-load-trigger").forEach((async t=>{t.innerHTML=e;let l=t.dataset.formId,r=t.dataset.shortcodeId,o=new FormData,n=!1;null!=l?(o.append("form-id",l),n=await FormSubmit.fetchRestApi("forms/load_form",o)):(o.append("shortcode-id",r),n=await FormSubmit.fetchRestApi("forms/load_form_results",o)),n&&(t.innerHTML=n)}))})),window.addEventListener("online",(function(){document.querySelectorAll(".form-submit").forEach((e=>{e.disabled=!1,e.querySelectorAll(".offline").forEach((e=>e.remove()))}))})),window.addEventListener("offline",(function(){document.querySelectorAll(".form-submit").forEach((e=>{e.disabled=!0,null==e.querySelector(".online")&&(e.innerHTML='<div class="online">'+e.innerHTML+"</div>"),e.innerHTML+='<div class="offline">You are offline</div>'}))})),document.addEventListener("click",(function(e){let t=e.target;if(t.matches(".add")){let e=t.closest(".clone-div"),l=c(e);d(t.closest(".clone-divs-wrapper")),l.querySelectorAll(".wp-editor-area").forEach(((t,l)=>{let r=tinymce.get(e.querySelectorAll(".wp-editor-area")[l].id);if(null!=r){let e=r.settings;for(const t in e)console.log(`${t}: ${e[t]}`),"string"==typeof e[t]&&(e[t]=e[t].replace(/(.*)([0-9])/,((e,t,l)=>t+(parseInt(l)+1))));tinymce.init(e)}})),t.remove()}t.matches(".remove")&&u(t),t.matches('.sim-form-wrapper [name="submit-form"]')&&(e.stopPropagation(),async function(e){let t=e.closest("form");t.querySelectorAll(".required:not(hidden) input, .required:not(hidden) textarea, .required:not(hidden) select").forEach((e=>{null!=e.closest("div.nice-select")||"file"==e.type&&null!=e.closest(".file-upload-wrap").querySelector(".document-preview input")||(e.required=!0)}));let l=await FormSubmit.submitForm(e,"forms/save_form_input");l&&(Main.displayMessage(l),t.dataset.reset&&FormSubmit.formReset(t))}(t)),(t.matches(".formbuilder-switch")||t.matches(".formbuilder-switch-back"))&&async function(e){let t,r=e.closest(".sim-form-wrapper"),n=e.outerHTML,a=new FormData;const i=new URL(window.location);e.matches(".formbuilder-switch")?(a.append("formbuilder",!0),i.searchParams.set("formbuilder",!0),t=r.querySelector("form.sim-form-wrapper").dataset.formId):(i.searchParams.delete("formbuilder"),t=r.querySelector('[name="form-id"]').value),window.history.pushState({},"",i),a.append("form-id",t);let s=Main.showLoader(e,!1,50,"Requesting form...");r.innerHTML=s.outerHTML;let c=await FormSubmit.fetchRestApi("forms/form_builder",a);c?(r.innerHTML=c.html,function(e,t){l=[];let r=document.createElement("div");r.innerHTML=e.html,l=Array.prototype.slice.call(r.getElementsByTagName("script")),e.js&&(r.innerHTML=e.js,l=[...r.children].concat(l),o(t)),e.css&&(r.innerHTML=e.css,[...r.children].forEach((e=>{document.head.appendChild(e)})))}(c,document)):s.outerHTML=n}(t),(t.matches(".archive-switch-hide")||t.matches(".archive-switch-show"))&&async function(e){const t=new URL(window.location);e.matches(".archive-switch-show")?t.searchParams.set("archived",!0):t.searchParams.delete("archived"),window.history.pushState({},"",t),w(e)}(t),(t.matches(".only-own-switch-all")||t.matches(".only-own-switch-on"))&&async function(e){const t=new URL(window.location);e.matches(".only-own-switch-on")?(t.searchParams.set("only-own",!0),t.searchParams.delete("all",!0)):(t.searchParams.set("all",!0),t.searchParams.delete("only-own")),window.history.pushState({},"",t),w(e)}(t)})),document.addEventListener("change",(e=>{if(e.target.matches("input[list]")&&e.target.name.includes("[")){e.stopImmediatePropagation();let t=e.target.list.querySelector(`[value="${e.target.value}" i]`);if(null!=t){let l=t.dataset.value;null!=l&&y(e.target,l,"",e.target.closest("form"))}}})),t})()));
//# sourceMappingURL=forms.min.js.map